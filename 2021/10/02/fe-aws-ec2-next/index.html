<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>EC2로 Next.js 앱 배포하기 - zig-log</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="zig-log"><meta name="msapplication-TileImage" content="/images/balloon-favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="zig-log"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="EC2 | Next.js | Node.js | pm2 | nginx"><meta property="og:type" content="blog"><meta property="og:title" content="EC2로 Next.js 앱 배포하기"><meta property="og:url" content="https://zigsong.github.io/2021/10/02/fe-aws-ec2-next/"><meta property="og:site_name" content="zig-log"><meta property="og:description" content="EC2 | Next.js | Node.js | pm2 | nginx"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://zigsong.github.io/images/mac-thumbnail.jpeg"><meta property="article:published_time" content="2021-10-02T11:36:40.000Z"><meta property="article:modified_time" content="2021-11-07T05:40:35.155Z"><meta property="article:author" content="jieun song"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/images/mac-thumbnail.jpeg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://zigsong.github.io/2021/10/02/fe-aws-ec2-next/"},"headline":"EC2로 Next.js 앱 배포하기","image":[],"datePublished":"2021-10-02T11:36:40.000Z","dateModified":"2021-11-07T05:40:35.155Z","author":{"@type":"Person","name":"jieun song"},"description":"EC2 | Next.js | Node.js | pm2 | nginx"}</script><link rel="canonical" href="https://zigsong.github.io/2021/10/02/fe-aws-ec2-next/"><link rel="icon" href="/images/balloon-favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">ZIG-LOG</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/zigsong"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-10-02T11:36:40.000Z" title="2021. 10. 2. 오후 8:36:40">2021-10-02</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-11-07T05:40:35.155Z" title="2021. 11. 7. 오후 2:40:35">2021-11-07</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a></span><span class="level-item">35 minutes read (About 5297 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">EC2로 Next.js 앱 배포하기</h1><div class="content"><h3 id="EC2-Next-js-Node-js-pm2-nginx"><a href="#EC2-Next-js-Node-js-pm2-nginx" class="headerlink" title="EC2 | Next.js | Node.js | pm2 | nginx"></a>EC2 | Next.js | Node.js | pm2 | nginx</h3><img class="preview" src="/images/mac-thumbnail.jpeg">

<span id="more"></span>

<br />
<br />

<p>SSR을 사용하는 next.js 앱을 EC2에 배포하려다가 이것도 하고 저것도 하고… 결국 주말 하루를 꼬박 날리고야 만 대장정을 시작해보려고 한다.</p>
<hr>
<h2 id="1-AWS-인스턴스-생성"><a href="#1-AWS-인스턴스-생성" class="headerlink" title="1. AWS 인스턴스 생성"></a>1. AWS 인스턴스 생성</h2><p>aws 계정에 로그인한 후, EC2 대시보드에 들어가 우측 상단의 [인스턴스 시작] 버튼을 누른다.</p>
<img src="/images/article/fe-aws-ec2-next/01.png" width="720px" />
<br />

<h3 id="✅-단계-1-AMI-선택"><a href="#✅-단계-1-AMI-선택" class="headerlink" title="✅ 단계 1: AMI 선택"></a>✅ 단계 1: AMI 선택</h3><p>AMI가 뭘까? (<del>아미?</del> 🔫)</p>
<p>AMI는 Amazon Machine Image의 약자로, 인스턴스를 시작하는 데 필요한 정보를 제공한다. EC2 인스턴스와 같은 가상 서버들을 생성하는 데 필요한 마스터 이미지, 즉 운영체제에 필요한 템플릿을 캡쳐해 놓은 스냅샷 이미지와 같다.</p>
<p>호스팅 컴퓨터로 Ubuntu 18.04 버전의 SSD Volume type을 선택한다. </p>
<img src="/images/article/fe-aws-ec2-next/02.png" width="720px" />
<br />

<blockquote>
<p>👾 <strong>SSD란?</strong><br>Solid State Disk의 약자로, 보조기억장치를 가리킨다.<br>(그냥 궁금해서)</p>
</blockquote>
<h3 id="✅-단계-2-인스턴스-유형-선택"><a href="#✅-단계-2-인스턴스-유형-선택" class="headerlink" title="✅ 단계 2: 인스턴스 유형 선택"></a>✅ 단계 2: 인스턴스 유형 선택</h3><p><del>현재 테크코스의 계정으로 내 돈은 아니지만</del>, 아무튼 간에 t2.micro 또는 t2.medium을 선택한다. 프리티어 이용 시 t2.micro만 사용 가능하다.</p>
<img src="/images/article/fe-aws-ec2-next/03.png" width="720px" />
<br />

<h3 id="✅-단계-3-인스턴스-세부-정보-구성"><a href="#✅-단계-3-인스턴스-세부-정보-구성" class="headerlink" title="✅ 단계 3: 인스턴스 세부 정보 구성"></a>✅ 단계 3: 인스턴스 세부 정보 구성</h3><p>VPC와 서브넷을 선택하고, 퍼블릭 IP를 활성화해준다. (노출되어도 상관없는 정보라고 믿어본다…)</p>
<img src="/images/article/fe-aws-ec2-next/04.png" width="720px" />
<br />

<p><strong>VPC</strong>란 Virtual Private Cloud의 약자로, 사용자의 AWS 계정 전용 가상 네트워크다. VPC가 없다면 수많은 EC2 인스턴스들이 서로 거미줄처럼 연결되고 인터넷과 연결되어 복잡도를 증가시킬 것이다.<br>VPC를 적용하여 VPC별로 네트워크를 구성하고, 독립적으로 네트워크 설정을 줄 수 있다. 또, VPC를 사용하면 리소스 배치, 연결 및 보안을 포함하여 가상 네트워킹 환경을 제어할 수 있다</p>
<p><strong>서브넷</strong>은 VPC의 IP 주소 범위를 가리킨다. VPC 내부의, VPC보다 더 작은 단위를 가리킨다. 더 많은 네트워크망을 만들기 위해 서브넷을 사용한다.</p>
<p>VPC와 서브넷은 아래와 같은 구조로 이루어져 있다.</p>
<img src="/images/article/fe-aws-ec2-next/08.png" width="720px" />
<br />

<blockquote>
<p>👾 <strong>EC2? VPC?</strong> <br /><br>EC2는 computing service, VPC는 Virtual Private Cloud<br>EC2는 VPC의 일부이며 EC2 인스턴스에 접근을 위해서는 VPC가 필요하다.</p>
</blockquote>
<blockquote>
<p>👾 <strong>public IP vs private IP</strong> <br /><br><strong>퍼블릭 IP 주소</strong>는 인터넷을 통해 연결할 수 있는 IPv4 주소이다. 퍼블릭 주소는 인스턴스와 인터넷의 상호 통신을 위해 사용된다. 또한, 퍼블릭 IP 주소가 할당된 각 인스턴스에는 외부 DNS 호스트이름이 할당된다. <br /><br><strong>프라이빗 IP 주소</strong>는 인터넷을 통해 연결할 수 없는 IP 주소이다. 프라이빗 IPv4 주소는 동일 VPC에서 인스턴스 간의 통신을 위해 사용될 수 있다. 즉 우리끼리, 내부 네트워크 내에서 위치를 찾아갈 때 사용한다. 이때 각각의 VPC는 완전히 독립적이기 때문에 VPC간 통신을 위한다면 VPC 피어링 서비스를 고려해볼 수 있다.</p>
</blockquote>
<h3 id="✅-단계-4-스토리지-추가"><a href="#✅-단계-4-스토리지-추가" class="headerlink" title="✅ 단계 4: 스토리지 추가"></a>✅ 단계 4: 스토리지 추가</h3><p>원하는 볼륨 크기를 설정한다. EC2의 하드디스크 용량을 설정하는 것이다. (30GiB 이상을 권장한다. 하지만 그냥 기본값으로 하고 넘어갔다. 내 돈이 아니니까…💸)</p>
<img src="/images/article/fe-aws-ec2-next/05.png" width="720px" />
<br />

<h3 id="✅-단계-5-태그-추가"><a href="#✅-단계-5-태그-추가" class="headerlink" title="✅ 단계 5: 태그 추가"></a>✅ 단계 5: 태그 추가</h3><p>다른 사람의 서버와 구분할 수 있도록 <code>Name</code> 태그를 붙여준다.</p>
<img src="/images/article/fe-aws-ec2-next/06.png" width="720px" />
<br />

<h3 id="✅-단계-6-보안-그룹-구성"><a href="#✅-단계-6-보안-그룹-구성" class="headerlink" title="✅ 단계 6: 보안 그룹 구성"></a>✅ 단계 6: 보안 그룹 구성</h3><p>보안 그룹 설정을 통해 EC2 인스턴스로 들어오고 나가는 트래픽을 세부적으로 제어할 수 있다.<br>ex) SSH 접속 포트는 22번, 서비스 기본 포트는 80번</p>
<p>현재 본인 소유의 계정이 아니므로, 새로 만들지 않고 기존의 보안 그룹을 선택해주었다.</p>
<ul>
<li>인바운드 - 외부에서 인스턴스로 들어오는 요청</li>
<li>아웃바운드 - 인스턴스에서 외부로 나가는 트래픽</li>
</ul>
<img src="/images/article/fe-aws-ec2-next/07.png" width="720px" />

<h3 id="✅-단계-7-인스턴스-시작-검토"><a href="#✅-단계-7-인스턴스-시작-검토" class="headerlink" title="✅ 단계 7: 인스턴스 시작 검토"></a>✅ 단계 7: 인스턴스 시작 검토</h3><p>앞의 모든 단계 설정을 마무리했다면, 우측 하단의 [검토 및 시작]을 눌러 이전 단계의 설정들을 확인한 후, 키페어를 생성한다.</p>
<p>이 키페어는 SSH로 접속 시 필요한 키로, 한번 발급 받은 후 분실하면 다시 찾을 수 없으니 잘 보관해두자! 🔑<br>(<code>.pem</code> 파일 형식으로 생성된다)</p>
<img src="/images/article/fe-aws-ec2-next/09.png" width="560px" />
<br />

<p>기본적으로 RSA 방식으로 암호화된 공개키-비밀키 형식의 키페어를 제공하지만, 올해 8월부터 제공하는 ED25519 방식의 키페어를 발급 받으면 더욱 높은 수준의 보안 시스템을 이용할 수 있다고 한다.</p>
<p>클라이언트의 SSH에서 AWS EC2 인스턴스에 접속할 때 키페어는 다음과 같은 과정을 통해 교환된다.</p>
<img src="/images/article/fe-aws-ec2-next/10.png" width="560px" />
<br />

<p>이렇게 EC2 인스턴스가 생성되었다! <del>고작</del> 첫 번째 단계가 끝났다 😑</p>
<img src="/images/article/fe-aws-ec2-next/11.png" width="720px" />
<br />

<hr>
<h2 id="2-SSH-접속"><a href="#2-SSH-접속" class="headerlink" title="2. SSH 접속"></a>2. SSH 접속</h2><p>방금 만든 인스턴스를 클릭하고, [연결] 버튼을 눌러준다.</p>
<img src="/images/article/fe-aws-ec2-next/12.png" width="720px" />
<br />

<p>그러면 다음과 같이 친절하게 SSH 연결을 위한 커맨드를 알려준다.</p>
<img src="/images/article/fe-aws-ec2-next/13.png" width="640px" />
<br />

<p>로컬에서 발급받은 pem(키페어) 파일이 있는 위치로 이동하여, 시키는 대로 입력한다. </p>
<ol>
<li><code>chmod</code>(change mode)로 나(첫 번째)에게만 4(read) 즉 ‘읽기’ 권한을 제공하고, (그룹/전체에는 권한이 없다.)</li>
<li>public IP로 EC2 인스턴스에 접속한다.</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> chmod 400 KEY-zigsong-deploy-guidebook.pem</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ssh -i <span class="string">&quot;KEY-zigsong-deploy-guidebook.pem&quot;</span> ubuntu@ec2-13-125-205-164.ap-northeast-2.compute.amazonaws.com</span></span><br></pre></td></tr></table></figure>

<p>이때, 첫 접속 시 다음과 같은 에러가 발생할 수 있다. 원격지의 호스트를 로컬에 연결할 때 첫 번째로 자격을 증명하기 위한 과정이다. ‘yes’를 선택하여 쭉 넘어간다.</p>
<img src="/images/article/fe-aws-ec2-next/14.png" width="720px" />
<br />

<p>정상적으로 실행되면 다음과 같이 원격지 호스트 컴퓨터인 EC2 인스턴스에 접속된다!</p>
<img src="/images/article/fe-aws-ec2-next/15.png" width="640px" />
<br />

<hr>
<h2 id="3-프로젝트-세팅"><a href="#3-프로젝트-세팅" class="headerlink" title="3. 프로젝트 세팅"></a>3. 프로젝트 세팅</h2><p>Next.js로 (정말로) 간단하게 만든 페이지를 github에 올려두었다. SSH로 EC2에 접속한 상태에서, 해당 repository를 clone한다.</p>
<p>(내 레포를 클론해도 되겠지만, 간단한 라우팅 외에 아무것도 없으므로 아주 허탈할 것이다.)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/zigsong/a11y-airline.git</span></span><br></pre></td></tr></table></figure>

<p>우선 node를 설치해준다. <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/setting-up-node-on-ec2-instance.html">다음 링크</a>를 참조하여 설치를 진행했다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get update <span class="comment"># 기본적인 업데이트 진행</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> . ~/.nvm/nvm.sh</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> nvm install node</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>👾 apt-get vs yum</strong><br>크게 중요한 건 아닌 것 같지만, ssh에서 사용하는 명령어를 apt-get 방식으로 사용하는 곳도 있고, yum으로 사용하는 곳도 있다. 둘의 차이는 호스트가 RedHat 계열의 CentOS라면 yum을, Debian 계열의 Ubuntu라면 apt-get 방식을 사용하는 것이라고 한다. EC2 호스트 컴퓨터로 Ubuntu를 사용했기 때문에 되도록 apt-get 명령어를 사용했다. <br /><br>자세한 내용이 궁금하다면 아래 출처를 확인해 보자.<br><a target="_blank" rel="noopener" href="https://www.lesstif.com/lpt/ubuntu-apt-apt-get-redhat-centos-yum-89555903.html">Ubuntu apt(apt-get)와 Redhat/CentOS yum 명령어 비교표</a><br><a target="_blank" rel="noopener" href="https://coding-factory.tistory.com/318">리눅스란 무엇인가? (센토스 vs 우분투)</a></p>
</blockquote>
<p>아래 명령어로 node.js가 올바르게 설치되었는지 확인한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node -e <span class="string">&quot;console.log(&#x27;Running Node.js &#x27; + process.version)&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>yarn을 설치하고,</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -o- -L https://yarnpkg.com/install.sh | bash</span></span><br></pre></td></tr></table></figure>

<p>프로젝트의 패키지들을 설치해준다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yarn install</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="4-next-js-앱-custom-서버-설정"><a href="#4-next-js-앱-custom-서버-설정" class="headerlink" title="4. next.js 앱 custom 서버 설정"></a>4. next.js 앱 custom 서버 설정</h2><p><code>next start</code> 커맨드를 사용하면 vercel에서 제공하는 기본 서버를 사용할 수 있지만, 여기서는 EC2 인스턴스에서 따로 서버를 관리할 것이기 때문에 커스텀 서버를 만들어줄 것이다.<br>(👾 <code>next start</code>만으로도 EC2 서버를 돌릴 수 있다고 한다! <a target="_blank" rel="noopener" href="https://eminent-grill-3b7.notion.site/next-js-EC2-9e611603a8d34994a710efa40654078d">크루 신세한탄의 글</a> 참고)</p>
<p><a target="_blank" rel="noopener" href="https://nextjs.org/docs/advanced-features/custom-server">next.js 공식문서</a>를 참고하여 다음과 같이 express 서버 코드를 작성해 주었다.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">// 커스텀 서버를 next app과 연결시켜 준다.</span></span><br><span class="line"><span class="keyword">const</span> next = <span class="built_in">require</span>(<span class="string">&#x27;next&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dev = process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">8080</span>;</span><br><span class="line"><span class="keyword">const</span> app = next(&#123; dev &#125;);</span><br><span class="line"><span class="keyword">const</span> handle = app.getRequestHandler();</span><br><span class="line"></span><br><span class="line">app.prepare().then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> server = express();</span><br><span class="line"></span><br><span class="line">  server.use(express.json());</span><br><span class="line">  server.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;));</span><br><span class="line"></span><br><span class="line">  server.get(<span class="string">&#x27;*&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> handle(req, res));</span><br><span class="line"></span><br><span class="line">  server.listen(PORT, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`&gt; Ready on port <span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>next.js 커스텀 서버에서 사용하는 포트 번호는 EC2 인스턴스의 보안 그룹에서 인바운드 규칙에 포함되어 있어야 한다. 우테코 루트 계정을 사용하는 현재 보안 그룹에 따로 손을 댈 수 없어서, 기존 보안 그룹에 있는 8080 포트를 사용했다. ‘원본’의 ‘0.0.0.0/0’은 모든 소스를 허용함을 의미한다.</p>
<img src="/images/article/fe-aws-ec2-next/17.png" width="560px" />
<br />

<p>ssh 내부에서 아까 clone 받은 프로젝트 레포지토리로 들어가서, <code>next build</code>를 통해 커스텀 서버에서 관리할 파일을 생성한다. 실행 결과는 다음과 같다.</p>
<img src="/images/article/fe-aws-ec2-next/16.png" width="640px" />
<br />

<p>이제 <code>next start</code>로 서버를 실행해 준다. (모든 커맨드는 ssh 셸 안에서 이루어진다.)</p>
<p>인스턴스의 퍼블릭 IP 주소 또는 퍼블릭 DNS에 포트 ‘:8000’을 붙여 접속하면 정상적으로 next.js 앱이 뜨는 것을 확인할 수 있다.</p>
<img src="/images/article/fe-aws-ec2-next/18.png" width="720px" />
<br />


<div align="center">

<p><strong>&lt;그렇게 탄생한 앱&gt;</strong><br><img src="/images/article/fe-aws-ec2-next/19.png" width="720px" /><br><br /></p>
</div>

<p>…앱이 아주 썰렁하다. 어쩔 수 없다.</p>
<hr>
<h2 id="5-pm2로-프로세스-관리"><a href="#5-pm2로-프로세스-관리" class="headerlink" title="5. pm2로 프로세스 관리"></a>5. pm2로 프로세스 관리</h2><p>이렇게 열린 서버는 ssh 셸을 나가면 그대로 죽는다. 꽤나 허탈한 기분이다. node.js의 프로세스 매니저인 <strong>pm2</strong>를 사용하여 말로만 듣던, 엄청나게 멋져 보이던 ‘무중단 서비스’를 운영해 보자.</p>
<p>node.js는 기본적으로 싱글 스레드만 지원한다. pm2는 cluster 기능을 제공하여 최대 16개의 프로세스를 동시에 실행할 수 있게 해준다. 또 shell을 꺼도 계속 프로세스가 돌아갈 수 있도록 지원하며, 프로세스를 관찰하고 있다가 프로세스가 종료되면 다시 실행해줄 수 있다.</p>
<p>아래 명령어로 pm2를 설치해준다. (물론 여전히 ssh 셸에서, 우리의 next.js 앱 디렉토리 안에 있다.)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm install pm2 -g</span></span><br></pre></td></tr></table></figure>

<p>다음 명령어로 pm2가 관리할 새로운 프로세스를 실행한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pm2 start server.js</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 start server.js --name <span class="string">&quot;next&quot;</span> <span class="comment"># 프로세스 이름을 따로 지정하고 싶은 경우</span></span></span><br></pre></td></tr></table></figure>

<p><code>pm2 list</code> 명령어로 현재 실행중인 프로세스들을 확인할 수 있다.</p>
<img src="/images/article/fe-aws-ec2-next/20.png" width="720px" />
<br />

<p>이것저것 만져보며 프로세스를 일시정지하거나, 삭제하거나, error 시 재가동해 보자.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pm2 stop [id 또는 name]</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 restart [id 또는 name]</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 delete [id 또는 name]</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 start [id 또는 name] --watch <span class="comment"># 코드가 변경되면 프로세스를 재시작한다.</span></span></span><br></pre></td></tr></table></figure>

<p>pm2가 프로세스를 관리하고 있기 때문에, (오류가 발생하지 않는 한) 셸을 꺼도 서버는 계속 가동 중이다! (돈도 계속 나간다! 오예!)</p>
<blockquote>
<p>이렇게 ssh에서 pm2로 프로세스를 관리하는 것은 foreground로 프로세스를 돌리는 것에 해당한다. foreground 실행은 명령을 하나씩 실행하므로 사용자가 입력한 명령이 실행되어 결과가 출력될 때까지 기다려야 한다. <br /><br>pm2에서 background로 프로세스를 돌린다면 다른 작업을 수행하면서 프로세스를 계속 유지시킬 수 있다. ssh에서 background로 서버를 실행시키고 싶다면 명령어의 마지막에 <code>&amp;</code>를 입력하면 된다. background 작업은 터미널을 종료해도 계속 유지된다. (종료를 위해서는 프로세스를 kill해야 한다.)<br /><br>pm2는 <strong>데몬(Daemon)</strong> 방식을 사용하여 프로세스를 background에서 실행한다.</p>
</blockquote>
<hr>
<h2 id="6-nginx-설치"><a href="#6-nginx-설치" class="headerlink" title="6. nginx 설치"></a>6. nginx 설치</h2><p>nginx 동시접속 처리에 특화된 웹 서버 프로그램이다. 이벤트 드리븐(Event-Driven)의 비동기 처리 방식을 채택하여, 여러 개의 요청을 효율적으로 처리할 수 있다.</p>
<blockquote>
<p><strong>👾 웹 서버?</strong><br>웹 서버는 HTML, CSS, JavaScript, 이미지와 같은 정보를 웹 브라우저에 전송하는 역할을 한다.<br>(🍀<a href="https://zigsong.github.io/2021/09/12/fe-web-server-was/">참고 - Web Server와 WAS</a>)</p>
</blockquote>
<p>여기서는 nginx를 <strong>리버스 프록시(reverse proxy)</strong> 를 위해 사용할 것이다. 클라이언트가 가짜 서버에 요청을 보내면, 프록시 서버가 오리진 서버로부터 데이터를 가져오는 역할을 한다. 이때 nginx는 프록시 서버의 역할을 한다.</p>
<blockquote>
<p><strong>👾 프록시?</strong><br>프록시 서버는 클라이언트가 자신을 통해서 다른 네트워크 서비스에 간접적으로 접속할 수 있게 해 주는 컴퓨터 시스템이나 응용 프로그램을 가리킨다. 서버와 클라이언트 사이에서 중계 기능을 하며, 대리로 통신을 수행하는 서버이다. 프록시는 일반적으로 <strong>포워드 프록시(forward proxy)</strong> 와 <strong>리버스 프록시(reverse proxy)</strong> 로 구분된다.<br /><br>포워드 프록시는 실제 서버 대신 클라이언트의 요청을 받아 결과를 클라이언트에 전달하는 역할을 한다. 사용자가 google.com에 연결하려고 하면 포워드 프록시 서버가 요청을 받아서 google.com에 연결하여 그 결과를 클라이언트에 전달해주는 것이다. 이때 포워드 프록시는 캐시를 사용하여 성능 향상에 기여한다. <br /><br>리버스 프록시는 클라이언트가 데이터 요청 시 요청을 받아 내부 서버에서 데이터를 받은 후 클라이언트에 전달한다. 클라이언트는 내부 서버에 대한 정보를 알 필요 없이 리버스 프록시에만 요청을 보낸다. 리버스 프록시는 로드 밸런싱 등의 기능을 제공하기도 한다.<br /><br>👩‍🏫 포워드 프록시는 ‘클라이언트’를 감추는 역할, 리버스 프록시는 ‘서버’를 감추는 역할을 한다.</p>
</blockquote>
<p>앞 단계까지 정상적으로 진행해왔다면, EC2에서 제공한 IP 주소의 지정해준 포트(여기서는 8080)로만 접속이 가능하다. 그러나 매번 이렇게 특정한 포트 번호까지 붙여 접속하긴 여간 귀찮은 일이 아니다. </p>
<p>또 우리의 express 서버(next.js 앱의 커스텀 서버)가 어떤 포트로 열렸든 간에, 끝단의 사용자는 해당 정보를 알 필요가 없다. 웹 사이트의 기본 포트인 80포트(생략 가능)로 접속하기만 하면 될 뿐이다. nginx 웹 서버를 이용하여 8080 포트로 들어온 요청을 80포트로 전환시켜주고, 그 중간 과정은 숨겨줄 수 있다. </p>
<blockquote>
<p>즉, 외부에서 기본 포트인 80포트로 접속해도 리벅스 프록시 역할을 해주는 nginx가 express 서버로 <strong>proxy forwarding</strong>을 해준다.</p>
</blockquote>
<p>nginx를 설치하고, 서버를 시작한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install nginx</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo service nginx start</span></span><br></pre></td></tr></table></figure>

<p>아래 명령어를 통해 nginx가 설치된 경로를 확인할 수 있다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo find / -name nginx.conf</span></span><br></pre></td></tr></table></figure>

<p>nginx가 정상적으로 구동되고 있는지 확인해 보자.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ps -ef | grep nginx</span></span><br></pre></td></tr></table></figure>

<img src="/images/article/fe-aws-ec2-next/21.png" width="720px" />
<br />

<p>현재 EC2 인스턴스의 기본 포트(80, 또는 생략 가능)으로 접속하면 아래와 같은 화면이 나타난다.</p>
<img src="/images/article/fe-aws-ec2-next/22.png" width="360px" />
<br />

<p>nginx를 정상적으로 설치했다면, 기본 포트에 우리의 next.js 앱을 띄워주도록 설정을 수정해줘야 한다. nginx의 config를 설정하는 방법을 찾다가, 구글 검색 결과 최상단에 위치한 블로그를 많이 참고했다. 그런데 그 글이 우리 놀토 팀원 <a target="_blank" rel="noopener" href="https://velog.io/@new_wisdom/AWS-EC2%EC%97%90-Node.jsExpress-pm2-nginx-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0">아마찌의 포스트</a>였다니 😮 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /etc/nginx/sites-available <span class="comment"># 기본적으로 default 파일이 있다.</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo rm default</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo nano default</span> </span><br></pre></td></tr></table></figure>

<p>sites-available 디렉토리는, 가상 서버 환경들에 대한 설정 파일들이 위치하는 곳이다. nano 텍스트 에디터로 기본 default 파일을 삭제 후 새로 작성해 준다. (사실 nano 에디터 쓰는 법을 몰라서 vi 편집기로 수정했다.)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  listen [::]:80;</span><br><span class="line"></span><br><span class="line">  access_log /var/log/nginx/reverse-access.log;</span><br><span class="line">  error_log /var/log/nginx/reverse-error.log;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass http://127.0.0.1:8080; # 현재 사용 중인 포트 번호 </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>default 파일의 모든 문장의 끝에 세미콜론(;)을 붙여줘야 정상적으로 동작한다</p>
</blockquote>
<p>config 파일이 정상적으로 입력이 되었는지 확인해 보자</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo nginx -t</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>👾 nginx.conf를 직접 수정해주는 방식도 있지만, 어차피 nginx.conf가 nginx/sites-available의 내용을 포함하고 있기 때문에 둘 중 무엇을 수정하든 상관없다. (sites-available에 있는 파일들이 sites-enabled에 symlink로 연결되어 있고, nginx.conf는 sites-enabled에 있는 파일들을 포함한다.)</p>
</blockquote>
<p>참고로 nginx 서버에서 80포트를 사용하므로, EC2 인스턴스의 인바운드 규칙 역시 80포트를 포함하고 있어야 한다.</p>
<img src="/images/article/fe-aws-ec2-next/17.png" width="560px" />
<br />

<p>이제 EC2 퍼블릭 IP의 기본 포트로 앱 접속이 가능하다! </p>
<img src="/images/article/fe-aws-ec2-next/23.png" width="720px" />
<br />

<hr>
<h2 id="7-도메인-설정-및-https-연결"><a href="#7-도메인-설정-및-https-연결" class="headerlink" title="7. 도메인 설정 및 https 연결"></a>7. 도메인 설정 및 https 연결</h2><p>하지만 뭔가 아쉽다. 기본 포트인 80포트로의 연결은 동작하지만, 113.~ 으로 시작하는 못생긴 IP 주소를 누가 외우고 다닐까!</p>
<p>나만의 도메인을 등록해보자. <del>미션에까지 돈을 쓰고 싶진 않기 때문에</del> <a target="_blank" rel="noopener" href="https://내도메인.한국/">내도메인 한국</a> 사이트에서 괜찮은 주소를 찾았다. EC2에서 제공하는 Public IP 주소만 연결해주면 된다.</p>
<img src="/images/article/fe-aws-ec2-next/24.png" width="640px" />
<br />

<p>여전히 별거없지만, 이제 나름 도메인이라고 붙인 주소로 접속할 수 있다.</p>
<img src="/images/article/fe-aws-ec2-next/25.png" width="720px" />
<br />

<p>그런데 아무래도 저 ‘주의 요함’ 문구가 마음에 들지 않는다. HTTPS를 붙여 보안 설정을 강화해보도록 하자.</p>
<p>크루 <a target="_blank" rel="noopener" href="https://github.com/Puterism/infra-deploy-book/blob/cheffe/deploy-next-js-with-ec2.md">체프☕️의 가이드북</a>의 도움을 받았다.</p>
<p>nginx의 site-available 파일에 다시 들어가서 HTTPS 접속을 원하는 서버의 이름을 <code>server_name</code>으로 추가해준다. (위에서 생성한 도메인을 붙이면 된다.)</p>
<img src="/images/article/fe-aws-ec2-next/26.png" width="480px" />
<br />

<p>Certbot을 설치한다.</p>
<blockquote>
<p><strong>👾 Certbot?</strong><br>Let’s Encrypt 인증서를 사용하여 자동으로 HTTPS를 활성화하는 무료 오픈 소스 소프트웨어 도구이다.</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install python3-certbot-nginx</span></span><br></pre></td></tr></table></figure>

<p>다음 명령어로 인증서 발급을 시작한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo certbot --nginx</span></span><br></pre></td></tr></table></figure>

<p>이메일 작성, 약관 동의를 한 후 HTTPS 설정을 할 도메인을 입력한다. (다른 설정을 만지다가 한번 꼬여서 이 화면은 캡쳐하지 못했다 😵)</p>
<p>그러면 다음과 같은 2가지 선택지 중 선택하라고 나온다.</p>
<img src="/images/article/fe-aws-ec2-next/27.png" width="560px" />
<br />

<p>HTTP로 접속했을 때, HTTPS로 자동 리다이렉트되도록 설정할 것인지 묻는 옵션이다. 2번을 선택하면 Certbot에서 nginx 설정을 알아서 바꿔준다. <del>따로 설정하기 머리 아프기 때문에</del> 2번을 선택한다.</p>
<p>마지막으로 인증서가 만료되기 전에 알아서 갱신되도록 Crontab을 설정할 것이다. 먼저 Crontab 설정 파일을 연다. 설정 파일을 열 때 편한 편집기를 고르라는 메시지가 뜨는데, 편한 편집기로 고르면 된다.</p>
<blockquote>
<p><strong>👾 Crontab이란?</strong><br>리눅스의 작업 예약 스케줄러로, 특정 시간에 특정 작업을 할 수 있게 해주는 도구다.</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo crontab -e</span></span><br></pre></td></tr></table></figure>

<p>최하단에 다음 설정을 추가한다. 이렇게 설정하면 매월 1일 오후 6시마다 인증서를 갱신하고 nginx를 재시작하는 명령어가 실행된다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> 0 18 1 * * certbot renew --renew-hook=<span class="string">&quot;sudo service restart nginx&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>그럼 진짜 설정 끝!</p>
<img src="/images/article/fe-aws-ec2-next/28.png" width="560px" />
<br />

<p>이제 HTTPS로 접속할 수 있다. ‘주의 요함’ 대신 자물쇠 아이콘이 걸려있다.</p>
<img src="/images/article/fe-aws-ec2-next/29.png" width="720px" />
<br />

<hr>
<h2 id="요약"><a href="#요약" class="headerlink" title="요약"></a>요약</h2><ol>
<li>AWS EC2 인스턴스 생성</li>
<li>SSH 접속</li>
<li>git clone, node, yarn 설치</li>
<li>next.js 커스텀 서버 설정</li>
<li>pm2로 프로세스 관리</li>
<li>nginx로 리버스 프록시 설정</li>
<li>도메인 설정 및 https 연결</li>
</ol>
<p>어마어마한 과정이었다 😵</p>
<hr>
<p><strong>Ref</strong> </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/what-is-amazon-vpc.html">https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/what-is-amazon-vpc.html</a>  </li>
<li><a target="_blank" rel="noopener" href="https://medium.com/harrythegreat/aws-%EA%B0%80%EC%9E%A5%EC%89%BD%EA%B2%8C-vpc-%EA%B0%9C%EB%85%90%EC%9E%A1%EA%B8%B0-71eef95a7098">https://medium.com/harrythegreat/aws-가장쉽게-vpc-개념잡기-71eef95a7098</a>  </li>
<li><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/using-instance-addressing.html">https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/using-instance-addressing.html</a> </li>
<li><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/ko_kr/quicksight/latest/user/vpc-security-groups.html">https://docs.aws.amazon.com/ko_kr/quicksight/latest/user/vpc-security-groups.html</a>  </li>
<li><a target="_blank" rel="noopener" href="https://aws.amazon.com/ko/about-aws/whats-new/2021/08/amazon-ec2-customers-ed25519-keys-authentication/">https://aws.amazon.com/ko/about-aws/whats-new/2021/08/amazon-ec2-customers-ed25519-keys-authentication/</a>  </li>
<li><a target="_blank" rel="noopener" href="https://2ham-s.tistory.com/349">https://2ham-s.tistory.com/349</a>  </li>
<li><a target="_blank" rel="noopener" href="https://velog.io/@hojin9622/PM2-%EC%A0%95%EB%A6%AC">https://velog.io/@hojin9622/PM2-정리</a>  </li>
<li><a target="_blank" rel="noopener" href="https://twpower.github.io/50-make-nginx-virtual-servers">https://twpower.github.io/50-make-nginx-virtual-servers</a>  </li>
<li><a target="_blank" rel="noopener" href="https://bcp0109.tistory.com/194">https://bcp0109.tistory.com/194</a> </li>
<li><a target="_blank" rel="noopener" href="https://www.lesstif.com/system-admin/forward-proxy-reverse-proxy-21430345.html">https://www.lesstif.com/system-admin/forward-proxy-reverse-proxy-21430345.html</a>  </li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>EC2로 Next.js 앱 배포하기</p><p><a href="https://zigsong.github.io/2021/10/02/fe-aws-ec2-next/">https://zigsong.github.io/2021/10/02/fe-aws-ec2-next/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>jieun song</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2021-10-02</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2021-11-07</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/10/03/fe-react-18/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">React 18 톺아보기</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/10/02/fe-ssr/"><span class="level-item">Next.js 없이 React 앱 SSR 적용하기</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/images/profile_hexo.jpeg" alt="zig song"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">zig song</p><p class="is-size-6 is-block">FE Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Seoul</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">158</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">14</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-info is-outlined is-rounded" href="/" target="_self" rel="noopener">Home</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/zigsong"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:wldms5764@gmail.com"><i class="fa fa-envelope"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#EC2-Next-js-Node-js-pm2-nginx"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">EC2 | Next.js | Node.js | pm2 | nginx</span></span></a></li></ul><li><a class="level is-mobile" href="#1-AWS-인스턴스-생성"><span class="level-left"><span class="level-item">2</span><span class="level-item">1. AWS 인스턴스 생성</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#✅-단계-1-AMI-선택"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">✅ 단계 1: AMI 선택</span></span></a></li><li><a class="level is-mobile" href="#✅-단계-2-인스턴스-유형-선택"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">✅ 단계 2: 인스턴스 유형 선택</span></span></a></li><li><a class="level is-mobile" href="#✅-단계-3-인스턴스-세부-정보-구성"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">✅ 단계 3: 인스턴스 세부 정보 구성</span></span></a></li><li><a class="level is-mobile" href="#✅-단계-4-스토리지-추가"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">✅ 단계 4: 스토리지 추가</span></span></a></li><li><a class="level is-mobile" href="#✅-단계-5-태그-추가"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">✅ 단계 5: 태그 추가</span></span></a></li><li><a class="level is-mobile" href="#✅-단계-6-보안-그룹-구성"><span class="level-left"><span class="level-item">2.6</span><span class="level-item">✅ 단계 6: 보안 그룹 구성</span></span></a></li><li><a class="level is-mobile" href="#✅-단계-7-인스턴스-시작-검토"><span class="level-left"><span class="level-item">2.7</span><span class="level-item">✅ 단계 7: 인스턴스 시작 검토</span></span></a></li></ul></li><li><a class="level is-mobile" href="#2-SSH-접속"><span class="level-left"><span class="level-item">3</span><span class="level-item">2. SSH 접속</span></span></a></li><li><a class="level is-mobile" href="#3-프로젝트-세팅"><span class="level-left"><span class="level-item">4</span><span class="level-item">3. 프로젝트 세팅</span></span></a></li><li><a class="level is-mobile" href="#4-next-js-앱-custom-서버-설정"><span class="level-left"><span class="level-item">5</span><span class="level-item">4. next.js 앱 custom 서버 설정</span></span></a></li><li><a class="level is-mobile" href="#5-pm2로-프로세스-관리"><span class="level-left"><span class="level-item">6</span><span class="level-item">5. pm2로 프로세스 관리</span></span></a></li><li><a class="level is-mobile" href="#6-nginx-설치"><span class="level-left"><span class="level-item">7</span><span class="level-item">6. nginx 설치</span></span></a></li><li><a class="level is-mobile" href="#7-도메인-설정-및-https-연결"><span class="level-left"><span class="level-item">8</span><span class="level-item">7. 도메인 설정 및 https 연결</span></span></a></li><li><a class="level is-mobile" href="#요약"><span class="level-left"><span class="level-item">9</span><span class="level-item">요약</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/frontend/"><span class="level-start"><span class="level-item">frontend</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile" href="/categories/git-github/"><span class="level-start"><span class="level-item">git &amp; github</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/javascript/"><span class="level-start"><span class="level-item">javascript</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/nestjs/"><span class="level-start"><span class="level-item">nestjs</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/oop-true-and-false/"><span class="level-start"><span class="level-item">oop-true-and-false</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/refactoring/"><span class="level-start"><span class="level-item">refactoring</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/categories/retrospective/"><span class="level-start"><span class="level-item">retrospective</span></span><span class="level-end"><span class="level-item tag">32</span></span></a></li><li><a class="level is-mobile" href="/categories/troubleshooting/"><span class="level-start"><span class="level-item">troubleshooting</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/typescript/"><span class="level-start"><span class="level-item">typescript</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/woowacourse/"><span class="level-start"><span class="level-item">woowacourse</span></span><span class="level-end"><span class="level-item tag">35</span></span></a></li><li><a class="level is-mobile" href="/categories/wtc-havruta-fe/"><span class="level-start"><span class="level-item">wtc-havruta-fe</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/wtc-pr-log/"><span class="level-start"><span class="level-item">wtc-pr-log</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/wtc-study-log/"><span class="level-start"><span class="level-item">wtc-study-log</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/%EA%B8%80%EB%98%90/"><span class="level-start"><span class="level-item">글또</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><figure class="media-left"><a class="image" href="/2022/07/16/2022-7-week-3/"><img src="/images/retrospective-thumbnail.jpeg" alt="7월 3주차 기록"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-07-15T23:40:20.000Z">2022-07-16</time></p><p class="title"><a href="/2022/07/16/2022-7-week-3/">7월 3주차 기록</a></p><p class="categories"><a href="/categories/retrospective/">retrospective</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/07/10/npm-troubleshooting/"><img src="/images/troubleshooting-thumbnail.jpeg" alt="legacy-peer-deps 너 뭐 돼?"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-07-10T13:51:13.000Z">2022-07-10</time></p><p class="title"><a href="/2022/07/10/npm-troubleshooting/">legacy-peer-deps 너 뭐 돼?</a></p><p class="categories"><a href="/categories/troubleshooting/">troubleshooting</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/07/09/2022-7-week-2/"><img src="/images/retrospective-thumbnail.jpeg" alt="7월 2주차 기록"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-07-08T23:39:54.000Z">2022-07-09</time></p><p class="title"><a href="/2022/07/09/2022-7-week-2/">7월 2주차 기록</a></p><p class="categories"><a href="/categories/retrospective/">retrospective</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/07/02/2022-7-week-1/"><img src="/images/retrospective-thumbnail.jpeg" alt="7월 1주차 기록"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-07-02T05:50:48.000Z">2022-07-02</time></p><p class="title"><a href="/2022/07/02/2022-7-week-1/">7월 1주차 기록</a></p><p class="categories"><a href="/categories/retrospective/">retrospective</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/06/25/2022-6-week-4/"><img src="/images/retrospective-thumbnail.jpeg" alt="6월 4주차 기록"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-06-25T04:59:05.000Z">2022-06-25</time></p><p class="title"><a href="/2022/06/25/2022-6-week-4/">6월 4주차 기록</a></p><p class="categories"><a href="/categories/retrospective/">retrospective</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">July 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">June 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">May 2022</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">April 2022</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">March 2022</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">February 2022</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">January 2022</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">December 2021</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">November 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">October 2021</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">September 2021</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">August 2021</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">July 2021</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">June 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">May 2021</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">April 2021</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">March 2021</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">February 2021</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></div></div></div><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">ZIG-LOG</a><p class="is-size-7"><span>&copy; 2022 jieun song</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>