{"componentChunkName":"component---src-templates-blog-post-js","path":"/frontend/how-npm-works/","result":{"data":{"site":{"siteMetadata":{"title":"ziglog","author":"zigsong","lang":"en"}},"markdownRemark":{"id":"42ae9413-3c57-5be9-a72f-65404a91e288","excerpt":"npm은 어떻게 동작할까 어느날 갑자기 눈뜨자마자 궁금해졌다. 꿈에서 이상한 계시를 받았나? 아무 생각없이 npm을 사용하고 있었는데, 만약 누군가 이게 대체 어떻게 돌아가는 건지 묻는다면 대답을 못할 것 같았다. 패키지가 뭘까? 패키지: 에 기재된 파일 또는 디렉토리 모듈: Node…","html":"<p>npm은 어떻게 동작할까</p>\n<!-- more -->\n<hr>\n<p>어느날 갑자기 눈뜨자마자 궁금해졌다. 꿈에서 이상한 계시를 받았나? 아무 생각없이 npm을 사용하고 있었는데, 만약 누군가 이게 대체 어떻게 돌아가는 건지 묻는다면 대답을 못할 것 같았다.</p>\n<h3 id=\"패키지가-뭘까\" style=\"position:relative;\"><a href=\"#%ED%8C%A8%ED%82%A4%EC%A7%80%EA%B0%80-%EB%AD%98%EA%B9%8C\" aria-label=\"패키지가 뭘까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>패키지가 뭘까?</h3>\n<ul>\n<li>패키지: <code class=\"language-text\">package.json</code>에 기재된 파일 또는 디렉토리</li>\n<li>모듈: Node.js의 <code class=\"language-text\">require()</code> 문법으로 로드된 파일 또는 디렉토리. 일반 자바스크립트 파일 뿐 아니라 <code class=\"language-text\">package.json</code>에 <code class=\"language-text\">main</code> 필드를 포함하는 패키지도 모듈이 될 수 있다.</li>\n</ul>\n<p>대부분의 npm 패키지들은 <code class=\"language-text\">require</code>로 로드되기 때문에 모듈에 해당한다. 하지만 npm 패키지들이 반드시 모듈일 필요는 없다. 하지만 <code class=\"language-text\">main</code> 필드가 없다면 모듈이 아니다.</p>\n<blockquote>\n<p><code class=\"language-text\">main</code> 항목은 프로그램의 시작점이 되는 모듈의 ID다. ‘zig’라는 패키지가 있을 때, 이 패키지를 설치한 사용자가 <code class=\"language-text\">require('zig')</code>를 실행 시 <code class=\"language-text\">main</code>으로 지정한 모듈의 exports 객체가 반환된다.</p>\n</blockquote>\n<h3 id=\"파일과-디렉토리-이름\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EC%9D%BC%EA%B3%BC-%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-%EC%9D%B4%EB%A6%84\" aria-label=\"파일과 디렉토리 이름 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파일과 디렉토리 이름</h3>\n<p><code class=\"language-text\">package.json</code> 파일은 패키지를 정의한다.</p>\n<p><code class=\"language-text\">node_modules</code> 폴더는 Node.js가 모듈을 찾는 위치다.</p>\n<p><code class=\"language-text\">node_modules</code>에 있는 파일이라도 <code class=\"language-text\">package.json</code>이 없다면 패키지가 아니다.</p>\n<p>반대로 <code class=\"language-text\">package.json</code>이 있더라도 <code class=\"language-text\">index.js</code>나 <code class=\"language-text\">main</code> 필드가 존재하지 않는다면 모듈이 아니다. 따라서 <code class=\"language-text\">require()</code>의 인자로 사용할 수 없다.</p>\n<h3 id=\"의존성-지옥\" style=\"position:relative;\"><a href=\"#%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%A7%80%EC%98%A5\" aria-label=\"의존성 지옥 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>의존성 지옥</h3>\n<p>A와 B, C 모듈이 있을 때, A는 B v1.0을 필요로 하고, C는 B v2.0을 필요로 한다고 가정해 보자. 앱에 A와 C 모듈이 모두 필요하다면, 패키지 매니저는 B의 어떤 버전을 제공해야 할까?</p>\n<p>이를 의존성 지옥이라고 한다.</p>\n<h3 id=\"node-모듈-로더\" style=\"position:relative;\"><a href=\"#node-%EB%AA%A8%EB%93%88-%EB%A1%9C%EB%8D%94\" aria-label=\"node 모듈 로더 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Node 모듈 로더</h3>\n<p>대부분의 모듈 로더들은 메모리에 같은 모듈에 대해 2가지 버전을 로드할 수 없다. Node.js 모듈 로더는 이 문제를 해결한다!</p>\n<p>npm과 Node.js 모듈 로더는 의존성 관리를 위한 런타임에서 유용하게 동작한다.</p>\n<h3 id=\"-npm-install-시-무슨-일이-일어날까\" style=\"position:relative;\"><a href=\"#-npm-install-%EC%8B%9C-%EB%AC%B4%EC%8A%A8-%EC%9D%BC%EC%9D%B4-%EC%9D%BC%EC%96%B4%EB%82%A0%EA%B9%8C\" aria-label=\" npm install 시 무슨 일이 일어날까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>😮 npm install 시 무슨 일이 일어날까?</h3>\n<p>의존성 트리에 있는 모든 의존성들을 불러온다. 모든 의존성 파일들을 불러오는 대신, 특정 의존성의 이름과 버전, 또는 github url을 명시해줄 수도 있다.</p>\n<p>구체적으로 살펴보자.</p>\n<p><code class=\"language-text\">npm install</code>을 실행하면 <code class=\"language-text\">node_modules</code> 또는 <code class=\"language-text\">package-lock.json</code> 파일을 확인하고 의존성 트리(폴더 구조)를 따라 내려가며 트리를 복제한다.</p>\n<p>이후 <code class=\"language-text\">package.json</code>에서 관련있는 의존성들을 가져와 트리 복제본에 추가한다. 그리고 원본 트리와 트리 복제본을 비교하며 의존성들을 원본 트리에 추가한다. 이때 의존성들은 트리의 다른 루트나 브랜치들과 충돌하지 않도록 추가된다.</p>\n<p>마지막으로 원본 트리와 트리 복제본을 비교하여 <code class=\"language-text\">node_modules</code>에 새롭게 복제된 트리를 얻기 위한 동작들을 수행한다.</p>\n<blockquote>\n<p><strong>package-lock.json의 역할</strong></p>\n<p>A 패키지는 <code class=\"language-text\">B@v1.0</code>을, C 패키지는 <code class=\"language-text\">B@v2.0</code>을 필요로 할 때, 아래와 같이 npm package를 서로 다른 순서로 설치하는 두 가지 경우를 생각해보자.</p>\n</blockquote>\n<p><strong>✔️ 시나리오 1</strong></p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install A\nnpm install C</code></pre></div>\n<p><strong>✔️ 시나리오 2</strong></p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install C\nnpm install A</code></pre></div>\n<p>두 경우 모두 <code class=\"language-text\">package.json</code>은 아래와 같을 것이다.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"A\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"C\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2.0.0\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>하지만 의존성 트리를 표현하는 <code class=\"language-text\">package-lock.json</code>에는 차이가 발생한다.</p>\n<p><strong>✔️ 시나리오 1</strong></p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"A\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"requires\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"B\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"B\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"C\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2.0.0\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"requires\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"B\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2.0.0\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"B\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token string-property property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2.0.0\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>✔️ 시나리오 2</strong></p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"A\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"requires\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"B\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"B\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token string-property property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"B\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2.0.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"C\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2.0.0\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"requires\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"B\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2.0.0\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>만약 앱에서 <code class=\"language-text\">B</code> 패키지를 아래와 같이 로드한다면,</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> b <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>시나리오 1에서는 <code class=\"language-text\">B@v1.0</code>을 가리킬 것이며, 시나리오 2에서는 <code class=\"language-text\">B@v2.0</code>를 가리키게 된다. 따라서 프로젝트의 모든 팀원들이 같은 의존성 트리를 사용할 수 있도록 <code class=\"language-text\">package-lock.json</code>을 github에 올려야 한다.</p>\n<blockquote>\n<p><strong>🤔 nvm은 또 뭘까?</strong>\nnvm은 node-version-manager로, 서로 다른 node와 npm의 버전을 관리해준다.</p>\n</blockquote>\n<hr>\n<p><strong>Ref</strong>\n<a href=\"https://npm.github.io/how-npm-works-docs/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://npm.github.io/how-npm-works-docs/</a>\n<a href=\"https://programmingsummaries.tistory.com/385\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://programmingsummaries.tistory.com/385</a>\n<a href=\"https://dev.to/shree_j/how-npm-works-internally-4012\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://dev.to/shree_j/how-npm-works-internally-4012</a></p>","timeToRead":4,"frontmatter":{"title":"npm은 어떻게 동작할까","date":"October 31, 2021","description":null,"tags":["npm"],"disqus":null},"fields":{"langKey":"en"}}},"pageContext":{"slug":"/frontend/how-npm-works/","previous":{"fields":{"slug":"/javascript/proxy-and-reflect/","langKey":"en","directoryName":"javascript"},"frontmatter":{"date":"October 31, 2021","description":null,"title":"자바스크립트 Proxy & Reflect","tags":["javascript"]}},"next":{"fields":{"slug":"/javascript/js-reactivity/","langKey":"en","directoryName":"javascript"},"frontmatter":{"date":"October 31, 2021","description":null,"title":"자바스크립트 반응형","tags":["javascript"]}},"previousInSameTag":{"fields":{"slug":"/frontend/legacy-peer-deps/","langKey":"en","directoryName":"frontend"},"frontmatter":{"date":"July 10, 2022","description":null,"title":"legacy-peer-deps 너 뭐 돼?","tags":["npm"]}},"nextInSameTag":null,"translationsLink":[]}},"staticQueryHashes":["1522010811","1615650028","2894998521","3765107650","683610688"]}