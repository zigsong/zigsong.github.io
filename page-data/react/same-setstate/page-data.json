{"componentChunkName":"component---src-templates-blog-post-js","path":"/react/same-setstate/","result":{"data":{"site":{"siteMetadata":{"title":"ziglog","author":"zigsong","lang":"en"}},"markdownRemark":{"id":"176fd41e-de48-5aa9-b7d5-e8fc080621a8","excerpt":"다음 퀴즈의 답은? 다음 코드에서 이 찍히는 순서를 적어보자 본인은 일단 다음과 같이 제출해보았다. 왜 클릭을 3번씩이나 하는진 모르겠지만, 첫 번째 클릭 시  컴포넌트의 state가 바뀌므로 리렌더링이 발생하고, 두 번째 클릭 시  컴포넌트의 state…","html":"<h2 id=\"다음-퀴즈의-답은\" style=\"position:relative;\"><a href=\"#%EB%8B%A4%EC%9D%8C-%ED%80%B4%EC%A6%88%EC%9D%98-%EB%8B%B5%EC%9D%80\" aria-label=\"다음 퀴즈의 답은 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>다음 퀴즈의 답은?</h2>\n<hr>\n<p>다음 코드에서 <code class=\"language-text\">console.log()</code>이 찍히는 순서를 적어보자</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createRoot <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-dom/client\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> screen<span class=\"token punctuation\">,</span> fireEvent <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@testing-library/dom\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'render A'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>_state<span class=\"token punctuation\">,</span> setState<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'render App'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">click me</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">A</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> root <span class=\"token operator\">=</span> <span class=\"token function\">createRoot</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nroot<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> action <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> screen<span class=\"token punctuation\">.</span><span class=\"token function\">findByText</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click me\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  fireEvent<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  fireEvent<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  fireEvent<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span>duration <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> duration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>본인은 일단 다음과 같이 제출해보았다.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token string\">\"render App\"</span>\n<span class=\"token string\">\"render A\"</span>\n<span class=\"token string\">\"click\"</span>\n<span class=\"token string\">\"render App\"</span>\n<span class=\"token string\">\"render A\"</span>\n<span class=\"token string\">\"click\"</span>\n<span class=\"token string\">\"click\"</span></code></pre></div>\n<p>왜 클릭을 3번씩이나 하는진 모르겠지만,</p>\n<p>첫 번째 클릭 시 <code class=\"language-text\">App</code> 컴포넌트의 state가 바뀌므로 리렌더링이 발생하고,</p>\n<p>두 번째 클릭 시 <code class=\"language-text\">App</code> 컴포넌트의 state는 이전 값과 같으므로 리렌더링이 발생하지 않고,</p>\n<p>세 번째 클릭 시에도 마찬가지일 거라 생각했기 때문이다.</p>\n<p>(그래서 클릭을 왜 세 번씩이나 하는지 몰랐다.)</p>\n<p>결과는 가볍게 fail~</p>\n<p>정답은?</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token string\">\"render App\"</span>\n<span class=\"token string\">\"render A\"</span>\n<span class=\"token string\">\"click\"</span>\n<span class=\"token string\">\"render App\"</span>\n<span class=\"token string\">\"render A\"</span>\n<span class=\"token string\">\"click\"</span>\n<span class=\"token string\">\"render App\"</span>\n<span class=\"token string\">\"click\"</span></code></pre></div>\n<br>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 420px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6c5677c876ca248aee64e1dcd6b21d4a/65f94/01.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQADAAAAAAAAAAAAAAAAAAIBAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHq0yWDYAD/xAAbEAACAgMBAAAAAAAAAAAAAAABAhEiABASMf/aAAgBAQABBQIizeIZDVPWKsDf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAGxAAAwACAwAAAAAAAAAAAAAAAAEREiEgMlH/2gAIAQEABj8CmTdNs3Cy3w6vj//EAB0QAQADAAIDAQAAAAAAAAAAAAEAESExQRBhcYH/2gAIAQEAAT8h0IHtxCZb8ipg303AP8QROBsXxD6m94lbcSzx/9oADAMBAAIAAwAAABBDwDz/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAeEAEBAAICAgMAAAAAAAAAAAABEQAhMUEQYVGR0f/aAAgBAQABPxCBLkmorTu3rERetCRvHPx7xOIInCwdobIbd9/eQgWBInH7iUiLYBkeyTAQeHXj/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"01\" title=\"01\" src=\"/static/6c5677c876ca248aee64e1dcd6b21d4a/65f94/01.jpg\" srcset=\"/static/6c5677c876ca248aee64e1dcd6b21d4a/a80bd/01.jpg 148w,\n/static/6c5677c876ca248aee64e1dcd6b21d4a/1c91a/01.jpg 295w,\n/static/6c5677c876ca248aee64e1dcd6b21d4a/65f94/01.jpg 420w\" sizes=\"(max-width: 420px) 100vw, 420px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>React Quiz에서 처음으로 강적수를 만났다.</p>\n<p>무더운 여름 간만에 집중해서 원인을 알아내고 말리라</p>\n<h2 id=\"react의-상태-업데이트\" style=\"position:relative;\"><a href=\"#react%EC%9D%98-%EC%83%81%ED%83%9C-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8\" aria-label=\"react의 상태 업데이트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>React의 상태 업데이트</h2>\n<hr>\n<p>React 컴포넌트는 흔히 두 종류로 나뉜다. 하나는 클래스 컴포넌트, 다른 하나는 함수 컴포넌트이다.</p>\n<p>각 컴포넌트는 사용 방법이 거의 유사하지만, 그 내부 동작 원리를 들여다보면 미묘하게 다른 점들이 있다. 그 다른 점들 중 하나는 상태 업데이트와 리렌더링에 관한 것이다.</p>\n<p>클래스 컴포넌트에서는 클래스의 프로퍼티로 함수를 생성하고, <code class=\"language-text\">this.setState()</code> 함수 호출을 통해 상태 업데이트를 수행한다.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Clock</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React</span><span class=\"token punctuation\">.</span>Component <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>date<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timerID <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">tick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token number\">1000</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">componentWillUnmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timerID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">tick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      date<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Hello, world!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">It is </span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleTimeString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">.</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> root <span class=\"token operator\">=</span> ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">createRoot</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nroot<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Clock</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>반면 함수 컴포넌트에서는 <code class=\"language-text\">useState</code> hook으로 상태와 업데이터를 선언하고, 업데이터를 통해 상태를 업데이트한다.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">,</span> setName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Edward'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">function</span> <span class=\"token function\">handleClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t  <span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Taylor'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t  <span class=\"token function\">setAge</span><span class=\"token punctuation\">(</span>a <span class=\"token operator\">=></span> a <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t  <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 두 가지 상태 업데이트 방법은 일반적으로 동일하게 동작하며, React 개발자라면 이 두 가지 상태 업데이트 방법에 모두 익숙할 것이다.</p>\n<p>하지만 특수한 경우, 각 방식은 컴포넌트의 리렌더링에 있어 서로 다른 결과를 낳는다.</p>\n<p><a href=\"https://legacy.reactjs.org/docs/react-component.html#setstate\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">공식문서</a>에 따르면, 클래스 컴포넌트의 <code class=\"language-text\">setState()</code> 함수는 항상 리렌더링을 발생시킨다. (단, <code class=\"language-text\">shouldComponentUpdate()</code>가 false를 반환하는 경우 제외)</p>\n<p>하지만 또 다른 <a href=\"https://legacy.reactjs.org/docs/hooks-reference.html#bailing-out-of-a-state-update\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">공식문서</a>에 따르면, 함수 컴포넌트의 <code class=\"language-text\">useState()</code>로 선언한 상태를 같은 값으로 업데이트시키면, 리렌더링되지 않는다고 한다.</p>\n<p>하지만❗️한 가지 특수한 경우 상태 업데이터가 즉각적으로 호출되어 리렌더링이 발생한다.</p>\n<p>사실 자꾸 이 ‘특수한(occasional)’ 케이스가 뭔지 안알려줘서 열 받았다.</p>\n<p>그래서 내가 귀한 주말에 힘들게 직접 알아보았다.</p>\n<h2 id=\"usestate의-내부-동작-방식\" style=\"position:relative;\"><a href=\"#usestate%EC%9D%98-%EB%82%B4%EB%B6%80-%EB%8F%99%EC%9E%91-%EB%B0%A9%EC%8B%9D\" aria-label=\"usestate의 내부 동작 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useState()의 내부 동작 방식</h2>\n<hr>\n<p>이런저런 링크를 타고 오니 결국 내가 무서워하던 <a href=\"https://jser.dev/2023-06-19-how-does-usestate-work/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">jser.dev 아저씨의 문서</a>를 읽지 않을 수 없게 되었다.</p>\n<p>이제 이 지독한 아저씨와 함께 <code class=\"language-text\">useState()</code>의 코드를 샅샅이 뜯어 살펴볼 것이다.</p>\n<h3 id=\"1-첫-번째-렌더mount-시\" style=\"position:relative;\"><a href=\"#1-%EC%B2%AB-%EB%B2%88%EC%A7%B8-%EB%A0%8C%EB%8D%94mount-%EC%8B%9C\" aria-label=\"1 첫 번째 렌더mount 시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 첫 번째 렌더(mount) 시</h3>\n<p>첫 번째 렌더는 꽤 직관적이다.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">mountState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n  initialState<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constant\">S</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token constant\">S</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> Dispatch<span class=\"token operator\">&lt;</span>BasicStateAction<span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token operator\">>></span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// 새로운 hook이 생성된다. </span>\n  <span class=\"token keyword\">const</span> hook <span class=\"token operator\">=</span> <span class=\"token function\">mountWorkInProgressHook</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> initialState <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    initialState <span class=\"token operator\">=</span> <span class=\"token function\">initialState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// memoizedState가 실제 상태 값을 가지고 있다. </span>\n  hook<span class=\"token punctuation\">.</span>memoizedState <span class=\"token operator\">=</span> hook<span class=\"token punctuation\">.</span>baseState <span class=\"token operator\">=</span> initialState<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// 업데이트 queue에서 미래 상태 업데이트를 가지고 있다.</span>\n\t<span class=\"token comment\">// 상태 업데이트 시, 상태 값이 바로 업데이트되지 않는다는 점을 기억하자.</span>\n\t<span class=\"token comment\">// 상태 업데이트는 서로 다른 우선순위를 갖고 있고, 바로 처리될 필요가 없다. </span>\n\t<span class=\"token comment\">// 그렇기에 업데이트를 보류(stash)하고 나중에 처리할 수도 있다. </span>\n  <span class=\"token keyword\">const</span> queue<span class=\"token operator\">:</span> UpdateQueue<span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> BasicStateAction<span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token operator\">>></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    pending<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// lane은 우선순위를 의미한다.</span>\n    lanes<span class=\"token operator\">:</span> NoLanes<span class=\"token punctuation\">,</span>\n    dispatch<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    lastRenderedReducer<span class=\"token operator\">:</span> basicStateReducer<span class=\"token punctuation\">,</span>\n    lastRenderedState<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>initialState<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 이 queue는 hook 업데이트 queue에 해당한다. </span>\n  hook<span class=\"token punctuation\">.</span>queue <span class=\"token operator\">=</span> queue<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> dispatch<span class=\"token operator\">:</span> Dispatch<span class=\"token operator\">&lt;</span>\n    BasicStateAction<span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// dispatchSetState()는 실제 상태 업데이터를 가리킨다. </span>\n    <span class=\"token comment\">// 현재 fiber에 바인딩되어있다. </span>\n  <span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">.</span>dispatch <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token function\">dispatchSetState</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    currentlyRenderingFiber<span class=\"token punctuation\">,</span>\n    queue<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// useState()에서 반환되는 바로 그 값이다. </span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>hook<span class=\"token punctuation\">.</span>memoizedState<span class=\"token punctuation\">,</span> dispatch<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"2-setstate에서는-무슨-일이-발생할까\" style=\"position:relative;\"><a href=\"#2-setstate%EC%97%90%EC%84%9C%EB%8A%94-%EB%AC%B4%EC%8A%A8-%EC%9D%BC%EC%9D%B4-%EB%B0%9C%EC%83%9D%ED%95%A0%EA%B9%8C\" aria-label=\"2 setstate에서는 무슨 일이 발생할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. <code class=\"language-text\">setState()</code>에서는 무슨 일이 발생할까?</h3>\n<p>위 코드에서, <code class=\"language-text\">setState()</code>는 실제로 내부적으로 <code class=\"language-text\">dispatchSetState()</code>에 묶여있는 것을 알 수 있었다.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">dispatchSetState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">A</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n  fiber<span class=\"token operator\">:</span> Fiber<span class=\"token punctuation\">,</span>\n  queue<span class=\"token operator\">:</span> UpdateQueue<span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">A</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  action<span class=\"token operator\">:</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// 업데이트의 우선순위를 결정한다. </span>\n  <span class=\"token keyword\">const</span> lane <span class=\"token operator\">=</span> <span class=\"token function\">requestUpdateLane</span><span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// 보류(stash) 처리될 업데이트 객체. </span>\n  <span class=\"token keyword\">const</span> update<span class=\"token operator\">:</span> Update<span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">A</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    lane<span class=\"token punctuation\">,</span>\n    action<span class=\"token punctuation\">,</span>\n    hasEagerState<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    eagerState<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    next<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// render하는 동안에 setState를 할 수 있다.</span>\n\t<span class=\"token comment\">// (유용한 방법이지만, 무한 렌더링을 초래할 수 있으므로 주의하자.) </span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isRenderPhaseUpdate</span><span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">enqueueRenderPhaseUpdate</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">,</span> update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> alternate <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">.</span>alternate<span class=\"token punctuation\">;</span>\n\t  <span class=\"token comment\">// 이른 bailout을 위한 조건으로, 같은 값으로 상태 업데이트 시 아무것도 하지 말라는 의미.</span>\n\t  <span class=\"token comment\">// ⭐️ Bailout은 '서브트리의 리렌더링 방지를 위해 더 깊이 들어가는 것을 막는 것'을 의미한다.</span>\n\t  <span class=\"token comment\">// 이는 리렌더 과정 안에서 발생하며, 리렌더링 스케줄링을 막기 위해 존재한다.</span>\n\t  <span class=\"token comment\">// 하지만 이 조건문은 실제로는 hack에 가까운데, </span>\n\t  <span class=\"token comment\">// ⭐️ React가 '최선을 다해 리렌더를 스케줄링하는 것을 막지만, 보장할 수는 없기' 때문이다.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n      fiber<span class=\"token punctuation\">.</span>lanes <span class=\"token operator\">===</span> NoLanes <span class=\"token operator\">&amp;&amp;</span>\n      <span class=\"token punctuation\">(</span>alternate <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> alternate<span class=\"token punctuation\">.</span>lanes <span class=\"token operator\">===</span> NoLanes<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 이 queue는 현재 빈 상태인데, </span>\n      <span class=\"token comment\">// 이는 render 단계에 진입하기 전에 다음 상태의 값을 즉시(eagerly) 계산한다는 의미다.</span>\n      <span class=\"token comment\">// 만약 새로운 상태값이 지금 상태값과 같다면, 전체를 bailout할 수 있다. </span>\n      <span class=\"token keyword\">const</span> lastRenderedReducer <span class=\"token operator\">=</span> queue<span class=\"token punctuation\">.</span>lastRenderedReducer<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lastRenderedReducer <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> prevDispatcher<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> currentState<span class=\"token operator\">:</span> <span class=\"token constant\">S</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">.</span>lastRenderedState<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">const</span> eagerState <span class=\"token operator\">=</span> <span class=\"token function\">lastRenderedReducer</span><span class=\"token punctuation\">(</span>currentState<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          update<span class=\"token punctuation\">.</span>hasEagerState <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n          update<span class=\"token punctuation\">.</span>eagerState <span class=\"token operator\">=</span> eagerState<span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">is</span><span class=\"token punctuation\">(</span>eagerState<span class=\"token punctuation\">,</span> currentState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 빠른 경로. React에 리렌더를 스케줄링하지 않고 bailout 할 수 있다.</span>\n            <span class=\"token comment\">// 하지만 이 업데이트를 나중에 rebase할 수 있다. </span>\n            <span class=\"token comment\">// 만약 컴포넌트가 다른 이유로 리렌더된다면 그때 reducer는 바뀌었을 것이다.</span>\n            <span class=\"token function\">enqueueConcurrentHookUpdateAndEagerlyBailout</span><span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">,</span> queue<span class=\"token punctuation\">,</span> update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// 이 return문을 통해 업데이트가 스케줄링되는 것을 막는다. </span>\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>__DEV__<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            ReactCurrentDispatcher<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> prevDispatcher<span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 업데이트들을 보류(stash) 한다.</span>\n    <span class=\"token comment\">// 업데이트들은 실제 리렌더의 시작 단계에서 처리되고 fiber에 추가된다. </span>\n    <span class=\"token keyword\">const</span> root <span class=\"token operator\">=</span> <span class=\"token function\">enqueueConcurrentHookUpdate</span><span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">,</span> queue<span class=\"token punctuation\">,</span> update<span class=\"token punctuation\">,</span> lane<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>root <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> eventTime <span class=\"token operator\">=</span> <span class=\"token function\">requestEventTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// 리렌더를 스케쥴링한다. </span>\n      <span class=\"token comment\">// 하지만 바로 리렌더가 발생하진 않으며, 실제 스케줄링은 React 스케줄러에 달려있다. </span>\n      <span class=\"token function\">scheduleUpdateOnFiber</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> fiber<span class=\"token punctuation\">,</span> lane<span class=\"token punctuation\">,</span> eventTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">entangleTransitionUpdate</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> queue<span class=\"token punctuation\">,</span> lane<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>별표 친 주석들은 이후에 다시 보게 될 것이다. 정체를 알고 나면 정말 치사한 주석이 아닐 수 없다.</p>\n<p>아무튼 업데이트 객체들이 어떻게 처리되는지 더 살펴보자.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 렌더가 진행되고, concurrent event에서 업데이트를 받게 되면,</span>\n<span class=\"token comment\">// 이 업데이트를 fiber/hook queue에 추가하기 전에 현재 렌더가 끝날 때까지 기다린다. </span>\n<span class=\"token comment\">// 이 업데이트를 배열에 넣으면 나중에 queue, fiber, update, 그리고 기타 등등에 접근할 수 있다. </span>\n<span class=\"token keyword\">const</span> concurrentQueues<span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> concurrentQueuesIndex <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> concurrentlyUpdatedLanes<span class=\"token operator\">:</span> Lanes <span class=\"token operator\">=</span> NoLanes<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 이 함수는 prepareFreshStack() 안에서 호출된다.</span>\n<span class=\"token comment\">// 해당 함수는 리렌더의 초기 단계중 하나로, </span>\n<span class=\"token comment\">// 리렌더가 실제로 시작하기 전에, 모든 상태 업데이트들은 보류(stash)된다.</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">finishQueueingConcurrentUpdates</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> endIndex <span class=\"token operator\">=</span> concurrentQueuesIndex<span class=\"token punctuation\">;</span>\n  concurrentQueuesIndex <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  concurrentlyUpdatedLanes <span class=\"token operator\">=</span> NoLanes<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">&lt;</span> endIndex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>queue <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> update <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t    <span class=\"token comment\">// 이전에 언급했던 hook.queue를 떠올려보자.</span>\n\t    <span class=\"token comment\">// 여기서 보류된(stashed) 업데이트들이 마침내 이곳 fiber에 추가되어, 처리될 준비를 완료한다. </span>\n      <span class=\"token keyword\">const</span> pending <span class=\"token operator\">=</span> queue<span class=\"token punctuation\">.</span>pending<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pending <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        update<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> update<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        update<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> pending<span class=\"token punctuation\">.</span>next<span class=\"token punctuation\">;</span>\n        pending<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> update<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      queue<span class=\"token punctuation\">.</span>pending <span class=\"token operator\">=</span> update<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lane <span class=\"token operator\">!==</span> NoLane<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t    <span class=\"token comment\">// 이 함수 호출은 fiber node path를 dirty로 마킹한다. </span>\n      <span class=\"token function\">markUpdateLaneFromFiberToRoot</span><span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">,</span> update<span class=\"token punctuation\">,</span> lane<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">enqueueUpdate</span><span class=\"token punctuation\">(</span>\n  fiber<span class=\"token operator\">:</span> Fiber<span class=\"token punctuation\">,</span>\n  queue<span class=\"token operator\">:</span> ConcurrentQueue <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  update<span class=\"token operator\">:</span> ConcurrentUpdate <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  lane<span class=\"token operator\">:</span> Lane<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 아직 'childLanes'를 return path에 두지 않는다.</span>\n  <span class=\"token comment\">// 만약 렌더링 중이라면, 끝날 때까지 기다린다. </span>\n  <span class=\"token comment\">// 업데이트들은 내부적으로 message queue처럼 리스트에 보관되며, batch로 수행된다. </span>\n  concurrentQueues<span class=\"token punctuation\">[</span>concurrentQueuesIndex<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">;</span>\n  concurrentQueues<span class=\"token punctuation\">[</span>concurrentQueuesIndex<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> queue<span class=\"token punctuation\">;</span>\n  concurrentQueues<span class=\"token punctuation\">[</span>concurrentQueuesIndex<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> update<span class=\"token punctuation\">;</span>\n  concurrentQueues<span class=\"token punctuation\">[</span>concurrentQueuesIndex<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> lane<span class=\"token punctuation\">;</span>\n\n  concurrentlyUpdatedLanes <span class=\"token operator\">=</span> <span class=\"token function\">mergeLanes</span><span class=\"token punctuation\">(</span>concurrentlyUpdatedLanes<span class=\"token punctuation\">,</span> lane<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token comment\">// fiber의 'lane' 필드는 잡이 스케줄되었는지 확인하기 위해 몇몇 곳에서 사용된다.</span>\n  <span class=\"token comment\">// 이는 즉시(eager) bailout을 위한 것으로, 업데이트가 곧바로 이루어진다.</span>\n  fiber<span class=\"token punctuation\">.</span>lanes <span class=\"token operator\">=</span> <span class=\"token function\">mergeLanes</span><span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">.</span>lanes<span class=\"token punctuation\">,</span> lane<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token comment\">// ⭐️ 현재 fiber와 대체 fiber가 dirty로 마킹됐다.</span>\n  <span class=\"token keyword\">const</span> alternate <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">.</span>alternate<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>alternate <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    alternate<span class=\"token punctuation\">.</span>lanes <span class=\"token operator\">=</span> <span class=\"token function\">mergeLanes</span><span class=\"token punctuation\">(</span>alternate<span class=\"token punctuation\">.</span>lanes<span class=\"token punctuation\">,</span> lane<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">enqueueConcurrentHookUpdate</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">A</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n  fiber<span class=\"token operator\">:</span> Fiber<span class=\"token punctuation\">,</span>\n  queue<span class=\"token operator\">:</span> HookQueue<span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">A</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  update<span class=\"token operator\">:</span> HookUpdate<span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">A</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  lane<span class=\"token operator\">:</span> Lane<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> FiberRoot <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> concurrentQueue<span class=\"token operator\">:</span> ConcurrentQueue <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>queue<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> concurrentUpdate<span class=\"token operator\">:</span> ConcurrentUpdate <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>update<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">enqueueUpdate</span><span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">,</span> concurrentQueue<span class=\"token punctuation\">,</span> concurrentUpdate<span class=\"token punctuation\">,</span> lane<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">getRootForUpdatedFiber</span><span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">markUpdateLaneFromFiberToRoot</span><span class=\"token punctuation\">(</span>\n  sourceFiber<span class=\"token operator\">:</span> Fiber<span class=\"token punctuation\">,</span>\n  update<span class=\"token operator\">:</span> ConcurrentUpdate <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  lane<span class=\"token operator\">:</span> Lane<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// 현재 fiber의 lane을 업데이트한다. </span>\n  sourceFiber<span class=\"token punctuation\">.</span>lanes <span class=\"token operator\">=</span> <span class=\"token function\">mergeLanes</span><span class=\"token punctuation\">(</span>sourceFiber<span class=\"token punctuation\">.</span>lanes<span class=\"token punctuation\">,</span> lane<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> alternate <span class=\"token operator\">=</span> sourceFiber<span class=\"token punctuation\">.</span>alternate<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ⭐️ lane들은 현재 fiber와 대체 fiber 모두에서 업데이트된다.</span>\n  <span class=\"token comment\">// dispatchSetState()는 현재 fiber에 바인딩되어있기 때문에</span>\n  <span class=\"token comment\">// 상태를 업데이트하면 항상 현재 fiber tree를 업데이트하는 것은 아니다.</span>\n  <span class=\"token comment\">// 둘 모두를 업데이트하는 것은 모든 것을 정상 동작하게 만들지만, 사이드 이펙트도 있다. </span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>alternate <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    alternate<span class=\"token punctuation\">.</span>lanes <span class=\"token operator\">=</span> <span class=\"token function\">mergeLanes</span><span class=\"token punctuation\">(</span>alternate<span class=\"token punctuation\">.</span>lanes<span class=\"token punctuation\">,</span> lane<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\t\n\t<span class=\"token comment\">// 부모 경로에서 루트까지 따라가며 자식 lane을 업데이트한다. </span>\n  <span class=\"token keyword\">let</span> isHidden <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> parent <span class=\"token operator\">=</span> sourceFiber<span class=\"token punctuation\">.</span>return<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> node <span class=\"token operator\">=</span> sourceFiber<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>parent <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    parent<span class=\"token punctuation\">.</span>childLanes <span class=\"token operator\">=</span> <span class=\"token function\">mergeLanes</span><span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">.</span>childLanes<span class=\"token punctuation\">,</span> lane<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    alternate <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">.</span>alternate<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>alternate <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      alternate<span class=\"token punctuation\">.</span>childLanes <span class=\"token operator\">=</span> <span class=\"token function\">mergeLanes</span><span class=\"token punctuation\">(</span>alternate<span class=\"token punctuation\">.</span>childLanes<span class=\"token punctuation\">,</span> lane<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">.</span>tag <span class=\"token operator\">===</span> OffscreenComponent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> offscreenInstance<span class=\"token operator\">:</span> OffscreenInstance <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">.</span>stateNode<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>offscreenInstance<span class=\"token punctuation\">.</span>isHidden<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        isHidden <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    node <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">;</span>\n    parent <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">.</span>return<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isHidden <span class=\"token operator\">&amp;&amp;</span> update <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> node<span class=\"token punctuation\">.</span>tag <span class=\"token operator\">===</span> HostRoot<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> root<span class=\"token operator\">:</span> FiberRoot <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>stateNode<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">markHiddenUpdate</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> update<span class=\"token punctuation\">,</span> lane<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">scheduleUpdateOnFiber</span><span class=\"token punctuation\">(</span>\n  root<span class=\"token operator\">:</span> FiberRoot<span class=\"token punctuation\">,</span>\n  fiber<span class=\"token operator\">:</span> Fiber<span class=\"token punctuation\">,</span>\n  lane<span class=\"token operator\">:</span> Lane<span class=\"token punctuation\">,</span>\n  eventTime<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t  <span class=\"token comment\">// ... </span>\n\t  \n\t  <span class=\"token comment\">// scheduleUpdateOnFiber()에서 주목해야 하는 코드.</span>\n\t  <span class=\"token comment\">// 대기중인 업데이트가 있을 때 리렌더가 스케줄링되는 것을 보장한다.</span>\n\t  <span class=\"token comment\">// 실제 리렌더가 아직 시작하지 않았기 때문에 업데이트들은 아직 처리되지 않는다.</span>\n\t  <span class=\"token comment\">// 실제 리렌더의 시작은 이벤트의 종류나 스케줄러의 상태 등 여러 요인에 달려 있다.</span>\n    <span class=\"token function\">ensureRootIsScheduled</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> eventTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">// ... </span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"리렌더에서-usestate\" style=\"position:relative;\"><a href=\"#%EB%A6%AC%EB%A0%8C%EB%8D%94%EC%97%90%EC%84%9C-usestate\" aria-label=\"리렌더에서 usestate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>리렌더에서 useState()</h3>\n<p>보류(stash)된 업데이트들을 실제로 실행할 타이밍이다.</p>\n<p>이것은 실제로는 리렌더 단계의 <code class=\"language-text\">useState()</code>에서 발생한다.</p>\n<p>추후에 알겠지만, 상태고 뭐고 일단 리렌더를 조져버리는 것이다!</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">updateState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n  initialState<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constant\">S</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token constant\">S</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> Dispatch<span class=\"token operator\">&lt;</span>BasicStateAction<span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token operator\">>></span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">updateReducer</span><span class=\"token punctuation\">(</span>basicStateReducer<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>initialState<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">updateReducer</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">I</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">A</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n  <span class=\"token function-variable function\">reducer</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constant\">S</span><span class=\"token punctuation\">,</span>\n  initialArg<span class=\"token operator\">:</span> <span class=\"token constant\">I</span><span class=\"token punctuation\">,</span>\n  init<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token constant\">I</span> <span class=\"token operator\">=></span> <span class=\"token constant\">S</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> Dispatch<span class=\"token operator\">&lt;</span><span class=\"token constant\">A</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// updateWorkInProgressHook에서는 이전에 생성된 hook을 반환하여, 값을 얻을 수 있다. </span>\n  <span class=\"token keyword\">const</span> hook <span class=\"token operator\">=</span> <span class=\"token function\">updateWorkInProgressHook</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token comment\">// 업데이트 queue는 모든 업데이트들을 가지고 있다.</span>\n\t<span class=\"token comment\">// useState()는 리렌더가 시작된 후 호출되기 때문에,</span>\n\t<span class=\"token comment\">// 보류된(stashed) 업데이트들은 fiber로 이동한다. </span>\n  <span class=\"token keyword\">const</span> queue <span class=\"token operator\">=</span> hook<span class=\"token punctuation\">.</span>queue<span class=\"token punctuation\">;</span>\n  \n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>queue <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">'Should have a queue. This is likely a bug in React. Please file an issue.'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  \n  queue<span class=\"token punctuation\">.</span>lastRenderedReducer <span class=\"token operator\">=</span> reducer<span class=\"token punctuation\">;</span>\n  \n  <span class=\"token keyword\">const</span> current<span class=\"token operator\">:</span> Hook <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>currentHook<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// 서로 다른 우선순위를 가진 다양한 업데이트들이 있기 때문에</span>\n\t<span class=\"token comment\">// 그것들을 나중에 사용하기 위해 baseQueue에 보관된다.</span>\n\t<span class=\"token comment\">// 또한 업데이트가 수행되는 와중에도, 최종 상태가 올바른지 확인하기 위해 </span>\n\t<span class=\"token comment\">// 상태가 baseQueue에 저장되면, 모든 뒤따르는 업데이트도 그곳에 있어야 한다. </span>\n  <span class=\"token keyword\">let</span> baseQueue <span class=\"token operator\">=</span> current<span class=\"token punctuation\">.</span>baseQueue<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> pendingQueue <span class=\"token operator\">=</span> queue<span class=\"token punctuation\">.</span>pending<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pendingQueue <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// 아직 처리되지 않은 새로운 업데이트들이 있다.</span>\n\t\t<span class=\"token comment\">// 이것들을 base queue에 넣는다. </span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>baseQueue <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token comment\">// 대기 queue와 base queue를 병합한다. </span>\n      <span class=\"token keyword\">const</span> baseFirst <span class=\"token operator\">=</span> baseQueue<span class=\"token punctuation\">.</span>next<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> pendingFirst <span class=\"token operator\">=</span> pendingQueue<span class=\"token punctuation\">.</span>next<span class=\"token punctuation\">;</span>\n      baseQueue<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> pendingFirst<span class=\"token punctuation\">;</span>\n      pendingQueue<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> baseFirst<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    current<span class=\"token punctuation\">.</span>baseQueue <span class=\"token operator\">=</span> baseQueue <span class=\"token operator\">=</span> pendingQueue<span class=\"token punctuation\">;</span>\n\t   <span class=\"token comment\">// 대기 queue는 비워지고 baseQueue에 병합된다. </span>\n    queue<span class=\"token punctuation\">.</span>pending <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>baseQueue <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// 처리할 queue가 있다. </span>\n    <span class=\"token keyword\">const</span> first <span class=\"token operator\">=</span> baseQueue<span class=\"token punctuation\">.</span>next<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> newState <span class=\"token operator\">=</span> current<span class=\"token punctuation\">.</span>baseState<span class=\"token punctuation\">;</span>\n\n\t \t<span class=\"token comment\">// baseQueue를 처리한 후, 새로운 baseQueue가 생성된다. </span>\n    <span class=\"token keyword\">let</span> newBaseState <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> newBaseQueueFirst <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> newBaseQueueLast <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> update <span class=\"token operator\">=</span> first<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// do...while 루프를 통해 모든 업데이트를 수행한다. </span>\n    <span class=\"token keyword\">do</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>\n      <span class=\"token keyword\">const</span> shouldSkipUpdate <span class=\"token operator\">=</span> isHiddenUpdate\n        <span class=\"token operator\">?</span> <span class=\"token operator\">!</span><span class=\"token function\">isSubsetOfLanes</span><span class=\"token punctuation\">(</span><span class=\"token function\">getWorkInProgressRootRenderLanes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> updateLane<span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">:</span> <span class=\"token operator\">!</span><span class=\"token function\">isSubsetOfLanes</span><span class=\"token punctuation\">(</span>renderLanes<span class=\"token punctuation\">,</span> updateLane<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>shouldSkipUpdate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 우선순위로는 불충분하다. 이 업데이트를 스킵한다. </span>\n        <span class=\"token comment\">// 만약 이것이 처음으로 스킵된 업데이트라면, 이전 업데이트/상태가 새로운 base 업데이트/상태가 된다.</span>\n        <span class=\"token keyword\">const</span> clone<span class=\"token operator\">:</span> Update<span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">A</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n          lane<span class=\"token operator\">:</span> updateLane<span class=\"token punctuation\">,</span>\n          action<span class=\"token operator\">:</span> update<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">,</span>\n          hasEagerState<span class=\"token operator\">:</span> update<span class=\"token punctuation\">.</span>hasEagerState<span class=\"token punctuation\">,</span>\n          eagerState<span class=\"token operator\">:</span> update<span class=\"token punctuation\">.</span>eagerState<span class=\"token punctuation\">,</span>\n          next<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// 업데이트가 수행되지 않았으므로 새로운 baseQueue에 넣는다. </span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newBaseQueueLast <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          newBaseQueueFirst <span class=\"token operator\">=</span> newBaseQueueLast <span class=\"token operator\">=</span> clone<span class=\"token punctuation\">;</span>\n          newBaseState <span class=\"token operator\">=</span> newState<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          newBaseQueueLast <span class=\"token operator\">=</span> newBaseQueueLast<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> clone<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// queue에 남아있는 우선순위를 처리한다. </span>\n        currentlyRenderingFiber<span class=\"token punctuation\">.</span>lanes <span class=\"token operator\">=</span> <span class=\"token function\">mergeLanes</span><span class=\"token punctuation\">(</span>\n          currentlyRenderingFiber<span class=\"token punctuation\">.</span>lanes<span class=\"token punctuation\">,</span>\n          updateLane<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">markSkippedUpdateLanes</span><span class=\"token punctuation\">(</span>updateLane<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 이 업데이트는 충분한 우선순위를 갖고 있지 않다. </span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newBaseQueueLast <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      \n          <span class=\"token keyword\">const</span> clone<span class=\"token operator\">:</span> Update<span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">A</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// baseQueue에 대해 설명했듯이,</span>\n            <span class=\"token comment\">// 여기서 한번 newBaseQueue가 비어있지 않으면,</span>\n            <span class=\"token comment\">// 모든 뒤따르는 업데이트들은 미래에 사용되기 위해 보류(stash)된다. </span>\n            lane<span class=\"token operator\">:</span> NoLane<span class=\"token punctuation\">,</span>\n            action<span class=\"token operator\">:</span> update<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">,</span>\n            hasEagerState<span class=\"token operator\">:</span> update<span class=\"token punctuation\">.</span>hasEagerState<span class=\"token punctuation\">,</span>\n            eagerState<span class=\"token operator\">:</span> update<span class=\"token punctuation\">.</span>eagerState<span class=\"token punctuation\">,</span>\n            next<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n          newBaseQueueLast <span class=\"token operator\">=</span> newBaseQueueLast<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> clone<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// 이 업데이트를 수행한다. </span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>update<span class=\"token punctuation\">.</span>hasEagerState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// 만약 이 업데이트가 상태 업데이트(reducer가 아닌)이고 즉시(eagerly) 수행됐다면,</span>\n          <span class=\"token comment\">// 즉시 계산된 상태를 사용할 수있다. </span>\n          newState <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>update<span class=\"token punctuation\">.</span>eagerState<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token constant\">S</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> action <span class=\"token operator\">=</span> update<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">;</span>\n          newState <span class=\"token operator\">=</span> <span class=\"token function\">reducer</span><span class=\"token punctuation\">(</span>newState<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n      update <span class=\"token operator\">=</span> update<span class=\"token punctuation\">.</span>next<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>update <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> update <span class=\"token operator\">!==</span> first<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newBaseQueueLast <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      newBaseState <span class=\"token operator\">=</span> newState<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      newBaseQueueLast<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>newBaseQueueFirst<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// 새로운 상태가 현재 상태와 다를 때에만 fiber가 잡을 수행한다.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">is</span><span class=\"token punctuation\">(</span>newState<span class=\"token punctuation\">,</span> hook<span class=\"token punctuation\">.</span>memoizedState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t    <span class=\"token comment\">// 리렌더 동안에 상태 변화가 없다면 실제로 bailout(이른 bailout은 아니다)될 것이다. </span>\n      <span class=\"token function\">markWorkInProgressReceivedUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// 마침내 새로운 상태가 할당된다. </span>\n    hook<span class=\"token punctuation\">.</span>memoizedState <span class=\"token operator\">=</span> newState<span class=\"token punctuation\">;</span>\n    hook<span class=\"token punctuation\">.</span>baseState <span class=\"token operator\">=</span> newBaseState<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 다음 리렌더를 위해 새로운 baseQueue가 할당된다. </span>\n    hook<span class=\"token punctuation\">.</span>baseQueue <span class=\"token operator\">=</span> newBaseQueueLast<span class=\"token punctuation\">;</span>\n    queue<span class=\"token punctuation\">.</span>lastRenderedState <span class=\"token operator\">=</span> newState<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>baseQueue <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    queue<span class=\"token punctuation\">.</span>lanes <span class=\"token operator\">=</span> NoLanes<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token keyword\">const</span> dispatch<span class=\"token operator\">:</span> Dispatch<span class=\"token operator\">&lt;</span><span class=\"token constant\">A</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">.</span>dispatch<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 이제 새로운 상태와 dispatch()를 갖게 되었다! </span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>hook<span class=\"token punctuation\">.</span>memoizedState<span class=\"token punctuation\">,</span> dispatch<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>사실 바로 위 코드블럭은 도무지 무슨 소린지 이해하지 못했다.</p>\n<p>하지만 역시 모든 것을 다 이해할 필요는 없는 것 같다. ㅋ</p>\n<p>아무튼 이렇게 하루종일 애써서 번역했다. (사실 하루종일은 아니다. 한 시간 정도 걸렸다. <del>이렇게 말하는 게 더 멋있어 보이기도 한다.</del>) 한 20% 정도의 주석과 코드는 생략한 것인데도 사람 미치게 한다. 날도 더워 죽겠는데 미쳐보자.</p>\n<h2 id=\"그래서-뭣이-중헌디\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C-%EB%AD%A3%EC%9D%B4-%EC%A4%91%ED%97%8C%EB%94%94\" aria-label=\"그래서 뭣이 중헌디 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그래서 뭣이 중헌디?</h2>\n<hr>\n<p>위 문서는 다시 이런 <a href=\"https://react.dev/reference/react/useState#setstate-returns\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">공식 문서의 caveat</a>을 첨부한다. 그리고 그 문서에서는 이런 문장이 눈에 띈다.</p>\n<blockquote>\n<p>만약 현재 상태와 같은 상태로 업데이트를 시도한다면, React는 컴포넌트와 그 자식의 리렌더를 스킵할 것이다. 다만 몇몇 경우에 React는 자식 컴포넌트의 렌더링을 스킵하기 전에 현재 컴포넌트를 다시 호출할 수도 있다.</p>\n</blockquote>\n<p>진짜 열 받는다. 그래서 그 ‘몇몇 경우’가 뭐냐고?</p>\n<p>핵심은, 같은 값으로 호출한 <code class=\"language-text\">setState()</code>가 여전히 리렌더를 발생시킬 수 있다는 것이다. 바로 이 포스팅의 처음에 언급한 퀴즈와 같은 케이스.</p>\n<p>이를 이해하기 위해 다시 위에 난리를 벌여놓은 코드로 돌아가야 한다.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">dispatchSetState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">A</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n  fiber<span class=\"token operator\">:</span> Fiber<span class=\"token punctuation\">,</span>\n  queue<span class=\"token operator\">:</span> UpdateQueue<span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">A</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  action<span class=\"token operator\">:</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// 업데이트의 우선순위를 결정한다. </span>\n  <span class=\"token keyword\">const</span> lane <span class=\"token operator\">=</span> <span class=\"token function\">requestUpdateLane</span><span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// 보류(stash) 처리될 업데이트 객체. </span>\n  <span class=\"token keyword\">const</span> update<span class=\"token operator\">:</span> Update<span class=\"token operator\">&lt;</span><span class=\"token constant\">S</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">A</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    lane<span class=\"token punctuation\">,</span>\n    action<span class=\"token punctuation\">,</span>\n    hasEagerState<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    eagerState<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    next<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// render하는 동안에 setState를 할 수 있다.</span>\n\t<span class=\"token comment\">// (유용한 방법이지만, 무한 렌더링을 초래할 수 있으므로 주의하자.) </span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isRenderPhaseUpdate</span><span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">enqueueRenderPhaseUpdate</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">,</span> update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> alternate <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">.</span>alternate<span class=\"token punctuation\">;</span>\n  \t  <span class=\"token comment\">// 이른 bailout을 위한 조건으로, 같은 값으로 상태 업데이트 시 아무것도 하지 말라는 의미.</span>\n\t  <span class=\"token comment\">// ⭐️ Bailout은 '서브트리의 리렌더링 방지를 위해 더 깊이 들어가는 것을 막는 것'을 의미한다.</span>\n\t  <span class=\"token comment\">// 이는 리렌더 과정 안에서 발생하며, 리렌더링 스케줄링을 막기 위해 존재한다.</span>\n\t  <span class=\"token comment\">// 하지만 이 조건문은 실제로는 hack에 가까운데, </span>\n\t  <span class=\"token comment\">// ⭐️ React가 '최선을 다해 리렌더를 스케줄링하는 것을 막지만, 보장할 수는 없기' 때문이다.</span>\n\t  <span class=\"token comment\">// 다음 조건 하에서, 상태 값이 바뀌지 않으면 리렌더를 스케줄하는 것을 피한다. </span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n      fiber<span class=\"token punctuation\">.</span>lanes <span class=\"token operator\">===</span> NoLanes <span class=\"token operator\">&amp;&amp;</span>\n      <span class=\"token punctuation\">(</span>alternate <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> alternate<span class=\"token punctuation\">.</span>lanes <span class=\"token operator\">===</span> NoLanes<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t    <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>React가 ‘최선을 다해 리렌더를 스케줄링하는 것을 막지만, 보장할 수는 없기’ 때문이다.</p>\n</blockquote>\n<p>완전 미친 거지!</p>\n<p><code class=\"language-text\">dispatchSetState()</code> 함수에서는 hook을 위해 대기중인 업데이트 queue와 baseQueue가 비었는지 확인하는 것이 최선이다. 하지만 현재 구현에서 실제로 리렌더를 시작했는지는 알 수 없다.</p>\n<p>이를 알기 위해서는, fiber에 업데이트가 발생했는지 확인하는 간단한 방법 - 업데이트가 queue에 들어가면 fiber를 dirty로 마킹하는 방법 - 이 사용된다.</p>\n<p>하지만 여기서 뭐가 문제냐면?</p>\n<p>업데이트를 queue에 넣을 때, 현재 fiber와 대체 fiber가 함께 dirty로 마킹된다. <code class=\"language-text\">dispatchSetState()</code>가 현재 fiber에 바인딩되어 있기 때문에 이 과정이 필요하다. 따라서 현재 fiber와 대체 fiber 모두를 업데이트하지 않는다면 필요한 업데이트가 수행되는지 아닌지 알 수 없다.</p>\n<p>그리고 lanes를 초기화하는 단계는 실제 리렌더링을 수행하는 <code class=\"language-text\">beginWork()</code>에서야 시작된다.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">beginWork</span><span class=\"token punctuation\">(</span>\n  current<span class=\"token operator\">:</span> Fiber <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  workInProgress<span class=\"token operator\">:</span> Fiber<span class=\"token punctuation\">,</span>\n  renderLanes<span class=\"token operator\">:</span> Lanes<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Fiber <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token comment\">// 리렌더링을 시작하기 직전에 대기 업데이트 우선순위를 초기화한다. </span>\n  workInProgress<span class=\"token punctuation\">.</span>lanes <span class=\"token operator\">=</span> NoLanes<span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이러한 동작으로 한번 업데이트가 스케줄링되면, <strong>dirty로 마킹된 lane들을 초기화하는 것은 최소 2번의 리렌더링이 된 이후에 발생하게 되는 것이다.</strong></p>\n<p>즉 문제의 코드 실행 순서를 보면 다음과 같다.</p>\n<ol>\n<li>현재 fiber가 존재한다.</li>\n<li><code class=\"language-text\">setState(true)</code> 호출 시 이전 상태값과 다르므로 즉시 bailout이 발생하진 않는다.</li>\n<li>현재 fiber는 dirty로 마킹된다.</li>\n<li>현재 fiber와 대체 fiber가 dirty로 마킹되어 리렌더된다.</li>\n<li>대체 fiber가 현재 fiber가 되고, 현재 fiber는 dirty 마킹된 채로 대체 fiber가 된다.</li>\n<li><code class=\"language-text\">setState(true)</code> 를 호출한다. 이때 두 fiber 중 하나가 clean하지 않으므로, 즉시 bailout이 발생하진 않는다.</li>\n<li>현재 fiber와 대체 fiber 모두 dirty로 마킹된다.</li>\n<li>리렌더가 시작되고, 현재 fiber는 대체 fiber로부터 lane들을 할당받는다.</li>\n<li>현재 fiber와 대체 fiber 모두 clean한 상태</li>\n<li>현재 fiber와 대체 fiber가 다시 한 번 swap된다.</li>\n<li><code class=\"language-text\">setState(true)</code> 를 호출한다. 두 fiber가 모두 clean한 상태이므로 즉시 bailout이 발생한다!</li>\n</ol>\n<p>fiber가 어쩧고 어쩧고! 🤬</p>\n<p>이제는 정말 쉬운 말로 간추려 정리하지 않는다면 블로그고 뭐고 아무 소용이 없어져버릴 타이밍이다.</p>\n<h2 id=\"코드-정답-이해하기\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%93%9C-%EC%A0%95%EB%8B%B5-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0\" aria-label=\"코드 정답 이해하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코드 정답 이해하기</h2>\n<hr>\n<p>그동안 우리가 무엇을 하는지도 잊어버렸다.</p>\n<p>다시 처음 문제의 코드로 돌아가보자.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createRoot <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-dom/client\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> screen<span class=\"token punctuation\">,</span> fireEvent <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@testing-library/dom\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'render A'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>_state<span class=\"token punctuation\">,</span> setState<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'render App'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">click me</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">A</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> root <span class=\"token operator\">=</span> <span class=\"token function\">createRoot</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nroot<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> action <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> screen<span class=\"token punctuation\">.</span><span class=\"token function\">findByText</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click me\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  fireEvent<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  fireEvent<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  fireEvent<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span>duration <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> duration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token string\">\"render App\"</span>\n<span class=\"token string\">\"render A\"</span>\n<span class=\"token string\">\"click\"</span>\n<span class=\"token string\">\"render App\"</span>\n<span class=\"token string\">\"render A\"</span>\n<span class=\"token string\">\"click\"</span>\n<span class=\"token string\">\"render App\"</span>\n<span class=\"token string\">\"click\"</span></code></pre></div>\n<ol>\n<li>일단, 첫 번째 클릭까지는 이해된다. 즉 5번째 <code class=\"language-text\">console.log()</code>까지는 쉬운 납득</li>\n<li>두 번째 클릭 시, 이전 값과 같은 값으로 업데이트를 시도하는데, 이때 React가 멍청해서 바로 bailout을 하지 못하고 자기 자신 컴포넌트는 리렌더시킨다.\n<ul>\n<li>정말 성가시지만 이 과정은 리액트가 서브트리로 더 깊게 들어가 자식 컴포넌트의 리렌더링을 유발하지 않기 위해 필요하다고 한다! (변명 같지만 너그러운 우리가 이해해주자!) 그래서 다행스럽게도 <code class=\"language-text\">A</code> 컴포넌트는 리렌더되지 않는다.</li>\n</ul>\n</li>\n<li>세 번째 클릭 역시 이전 값과 같은 값으로 업데이트를 시도한다. 다만 이때는 현재 트리와 다음 트리가 이미 같은 상태이므로 React가 바로 bailout을 시키는 조건에 부합하여 리렌더가 발생하지 않는다.</li>\n</ol>\n<p>사실 이 모든 난리를 정리하자면</p>\n<blockquote>\n<p>React는 필요하다고 생각될 때에 리렌더를 하므로, 리렌더를 피하기 위한 너희 개발자들의 성능 개선 노력이 항상 먹히진 않는다는 것을 알아두자 ^0^</p>\n</blockquote>\n<p>이는 정말이지 대기업(Meta)의 횡포라고 생각한다.</p>\n<p>얻어간 것도, 내가 화낸다고 달라지는 것도 크게 없는 것 같지만</p>\n<p>실컷 영어공부한 것에 만족하기로 한다.</p>\n<h2 id=\"ref\" style=\"position:relative;\"><a href=\"#ref\" aria-label=\"ref permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ref</h2>\n<hr>\n<ul>\n<li><a href=\"https://bigfrontend.dev/react-quiz/useState%C2%A0%F0%9F%91%88%C2%A0%EB%AC%B8%EC%A0%9C\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://bigfrontend.dev/react-quiz/useState 👈 문제</a> 출처</li>\n<li><a href=\"https://jser.dev/2023-06-19-how-does-usestate-work/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://jser.dev/2023-06-19-how-does-usestate-work/</a></li>\n<li><a href=\"https://react.dev/reference/react/useState#setstate-returns\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://react.dev/reference/react/useState#setstate-returns</a></li>\n<li><a href=\"https://stackoverflow.com/questions/55373878/what-are-the-differences-when-re-rendering-after-state-was-set-with-hooks-compar\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://stackoverflow.com/questions/55373878/what-are-the-differences-when-re-rendering-after-state-was-set-with-hooks-compar</a></li>\n<li><a href=\"https://legacy.reactjs.org/docs/react-component.html#setstate\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://legacy.reactjs.org/docs/react-component.html#setstate</a></li>\n</ul>","timeToRead":16,"frontmatter":{"title":"React 리렌더링 삐그덕 삐그덕","date":"August 04, 2024","description":"React state를 같은 값으로 업데이트했을 때","tags":["react"],"disqus":null},"fields":{"langKey":"en"}}},"pageContext":{"slug":"/react/same-setstate/","previous":{"fields":{"slug":"/weekly/2024-8-week-2/","langKey":"en","directoryName":"weekly"},"frontmatter":{"date":"August 11, 2024","description":"어른이의 엠티","title":"8월 2주차 기록","tags":["weekly"]}},"next":{"fields":{"slug":"/weekly/2024-8-week-1/","langKey":"en","directoryName":"weekly"},"frontmatter":{"date":"August 04, 2024","description":"날씨가 사람 죽여요","title":"8월 첫주차 기록","tags":["weekly"]}},"previousInSameTag":null,"nextInSameTag":{"fields":{"slug":"/react/betray-of-useRef/","langKey":"en","directoryName":"react"},"frontmatter":{"date":"June 28, 2023","description":null,"title":"useRef의 배신","tags":["react"]}},"translationsLink":[]}},"staticQueryHashes":["1522010811","2466007692","2894998521","3765107650","683610688"]}